<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¼í™íŠ¸ìš´ì „ë©´í—ˆ - ì˜ˆì•½ ê´€ë¦¬</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css?v=20241225">
    <style>
        /* ì˜ˆì•½ ê´€ë¦¬ ì „ìš© ìŠ¤íƒ€ì¼ */
        .reservation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #1a2a4d;
            border-radius: 12px;
            border: 1px solid #2a4376;
        }
        
        .reservation-title {
            font-size: 24px;
            font-weight: 700;
            color: #fff;
            margin: 0;
        }
        
        .reservation-subtitle {
            color: #9ca3af;
            font-size: 14px;
            margin: 4px 0 0 0;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin: 0;
        }
        
        .content {
            display: block !important;
        }
        
        .calendar-container {
            display: grid;
            grid-template-columns: 1fr;
            width: 100%;
            overflow-x: auto;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #9ca3af;
            font-size: 14px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }
        
        .legend-color.course { background: #61fe3e; }
        .legend-color.time { background: #643efe; }
        .legend-color.none { background: #fef13e; }
        .legend-color.absent { background: #ef4444; }
        .legend-color.unlimited { background: #10b981; }
        .legend-color.custom { background: #eebedf; }
        
        
        .calendar-container {
            background: #0f1a30;
            border: 1px solid #2a4376;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }
        
        .calendar-wrapper {
            overflow-x: auto; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ ë³µì› */
            overflow-y: auto;
            max-height: 800px; /* ìµœëŒ€ ë†’ì´ 600px â†’ 800pxë¡œ í™•ì¥ */
            scrollbar-width: thin;
            -ms-overflow-style: auto;
        }
        
        .calendar-wrapper::-webkit-scrollbar {
            height: 8px; /* ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ë³µì› */
            width: 8px; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ë°” í‘œì‹œ */
        }
        .calendar-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .calendar-wrapper::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        .calendar-wrapper::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* í˜„ì¬ ì‹œê°„ í‘œì‹œì„  */
        .current-time-line {
            position: absolute;
            left: 520px; /* ì‹œê°„ ì»¬ëŸ¼(120px) + ì›”ìš”ì¼ ì»¬ëŸ¼(400px) = 520px */
            width: 400px; /* í™”ìš”ì¼ ì»¬ëŸ¼ ë„ˆë¹„ë§Œí¼ ì œí•œ */
            height: 2px;
            background: #ef4444;
            z-index: 1000; /* ë†’ì€ z-indexë¡œ ë‹¤ë¥¸ ìš”ì†Œë“¤ ìœ„ì— í‘œì‹œ */
            pointer-events: none;
            box-shadow: 0 0 4px rgba(239, 68, 68, 0.5); /* ì„ ëª…í•œ í‘œì‹œë¥¼ ìœ„í•œ ê·¸ë¦¼ì */
        }
        
        .current-time-indicator {
            position: absolute;
            left: 115px; /* ì‹œê°„ ì»¬ëŸ¼ ë‚´ë¶€ */
            width: 0;
            height: 0;
            border-left: 6px solid #ef4444;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
            z-index: 1001; /* ì„ ë³´ë‹¤ ë” ë†’ì€ z-index */
            pointer-events: none;
        }
        
        .calendar-header {
            display: grid;
            grid-template-columns: 120px repeat(7, 400px); /* ì‹œê°„ ì»¬ëŸ¼ 120px, ê° ìš”ì¼ ì»¬ëŸ¼ 400pxë¡œ 2ë°° í™•ì¥ */
            background: #1a2a4d;
            border-bottom: 1px solid #2a4376;
            overflow: visible; /* ìŠ¤í¬ë¡¤ ì œê±° */
            position: relative;
            z-index: 100; /* ì˜ˆì•½ ë¸”ë¡ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
        }
        
        .calendar-header > div {
            padding: 16px 12px;
            text-align: center;
            font-weight: 600;
            color: #e5e7eb;
            border-right: 1px solid #2a4376;
            background: #1a2a4d !important;
            position: relative;
            z-index: 1000;
        }
        
        .calendar-header > div:last-child {
            border-right: none;
        }
        
        .calendar-body {
            display: grid;
            grid-template-columns: 120px repeat(7, 400px); /* ì‹œê°„ ì»¬ëŸ¼ 120px, ê° ìš”ì¼ ì»¬ëŸ¼ 400pxë¡œ 2ë°° í™•ì¥ */
            min-height: 600px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
        }
        
        .time-slot {
            padding: 16px 12px;
            text-align: center;
            font-weight: 500;
            color: #9ca3af;
            border-right: 1px solid #2a4376;
            border-bottom: 1px solid #2a4376;
            background: #0f1a30;
            position: sticky;
            left: 0;
            z-index: 1002; /* ë¹¨ê°„ìƒ‰ ì„ (1000)ë³´ë‹¤ ë†’ê²Œ ì„¤ì • */
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .day-column {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1px;
            background: #2a4376;
        }
        
        .reservation-slot {
            height: 60px;
            background: #1a2a4d;
            border-right: 1px solid #2a4376;
            border-bottom: 1px solid #2a4376;
            cursor: pointer;
            position: relative;
            transition: background-color 0.2s;
            min-height: 60px;
        }
        
        .reservation-slot:hover {
            background: #2a4376;
        }
        
        .reservation-slot.selected {
            background: #3b82f6;
        }
        
        /* ì˜¤ëŠ˜ ë‚ ì§œ ì…€ ìŠ¤íƒ€ì¼ - ë” ê°•ë ¥í•œ ì„ íƒì */
        body .reservation-slot.today {
            background: #ffffff !important;
            border: 2px solid #3b82f6 !important;
            box-shadow: 0 0 0 2px #3b82f6 !important;
        }
        
        body .reservation-slot.today:hover {
            background: #f0f9ff !important;
        }
        
        /* ì˜¤ëŠ˜ ë‚ ì§œ ì…€ ê°•ì œ ì ìš© - ìˆ˜ìš”ì¼(10/1) */
        .reservation-slot[data-day="3"] {
            background: #1a2a4d !important;
        }
        
        .reservation-slot[data-day="3"]:hover {
            background: #2a4376 !important;
        }
        
        /* ì¶”ê°€ ê°•ì œ ì ìš© */
        body .calendar-body .day-column[data-day="3"] .reservation-slot {
            background: #1a2a4d !important;
        }
        
        .reservation-block {
            position: absolute !important;
            left: 2px !important;
            right: 2px !important;
            top: 0 !important;
            width: calc(100% - 4px) !important;
            background: #3b82f6 !important;
            border-radius: 4px !important;
            color: white !important;
            font-size: 12px !important;
            font-weight: 500 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 10 !important; /* í—¤ë”ë³´ë‹¤ ë‚®ê²Œ ì„¤ì • */
            cursor: pointer !important;
            padding: 2px 4px !important;
            min-height: 24px !important;
            box-sizing: border-box !important;
            transform: translateZ(0) !important; /* GPU ê°€ì†ìœ¼ë¡œ ë Œë”ë§ ê°œì„  */
        }
        
        .reservation-block.course { background: #61fe3e !important; }
        .reservation-block.time { background: #643efe !important; }
        .reservation-block.none { background: #fef13e !important; color: #000000 !important; } /* ë¹„íšŒì› - ë…¸ë€ìƒ‰ ë°°ê²½, ê²€ì€ìƒ‰ ê¸€ì”¨ */
        .reservation-block.absent { background: #ef4444 !important; }
        .reservation-block.unlimited { background: #10b981 !important; } /* ë…¹ìƒ‰ - ë¬´ì œí•œ */
        .reservation-block.custom { background: #eebedf !important; } /* ê¸°ë³¸ ìƒ‰ìƒ */
        
        .reservation-temp {
            position: absolute;
            left: 2px;
            right: 2px;
            background: rgba(59, 130, 246, 0.5);
            border: 1px solid #3b82f6;
            border-radius: 4px;
            color: white;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            padding: 2px 4px;
            min-height: 24px;
        }
        
        .time-indicator {
            position: fixed;
            background: #1a2a4d;
            color: #e5e7eb;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            z-index: 1000;
            pointer-events: none;
            border: 1px solid #3b82f6;
        }
        
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        
        .modal-content {
            background: #1a2a4d;
            border: 1px solid #2a4376;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #e5e7eb;
            margin: 0 0 8px 0;
        }
        
        .modal-subtitle {
            color: #9ca3af;
            font-size: 14px;
            margin: 0;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            color: #e5e7eb;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            background: #0f1a30;
            border: 1px solid #2a4376;
            border-radius: 8px;
            color: #e5e7eb;
            font-size: 14px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .time-group {
            display: flex;
            gap: 8px;
        }
        
        .time-group select {
            flex: 1;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }
        
        /* ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ë§ˆì§„ ê°•ì œ ì ìš© */
        #normalModeButtons,
        #editModeButtons {
            margin: 0 20px !important;
        }
    </style>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="brand">
                <div class="brand__name">í¼í™íŠ¸ìš´ì „ë©´í—ˆ</div>
                <div class="brand__role">ì‘ì•”ì—­ì </div>
            </div>
            <nav class="nav">
                <a class="nav__item" href="index.html">íšŒì› í˜„í™©</a>
                <a class="nav__item active" href="reservations.html">ì˜ˆì•½ í˜„í™©</a>
            </nav>
        </aside>

        <main class="main">
            <header class="topbar">
                <div class="topbar__title">ì˜ˆì•½ ê´€ë¦¬</div>
                <div class="topbar__spacer"></div>
                <div class="user">
                    <button class="btn btn--ghost" onclick="logout()" style="font-size: 12px;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>

            <section class="content">
                <div class="legend" style="margin: 0 0 30px 0; width: 1819px; height: 100px; padding: 8px 0;">
                    <div class="legend-item">
                        <div class="legend-color course"></div>
                        <span>ë¬´ì œí•œ</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color time"></div>
                        <span>ì‹œê°„í˜•</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color none"></div>
                        <span>ìƒí’ˆì—†ìŒ(ë¹„íšŒì›)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color absent"></div>
                        <span>ê²°ì„ì²˜ë¦¬</span>
                    </div>
                </div>
                <!-- ì£¼ê°„ ë„¤ë¹„ê²Œì´ì…˜ -->
                <div class="week-navigation" style="display: flex; justify-content: flex-start; align-items: center; gap: 12px; margin: 0 0 30px 0; height: 50px; padding: 8px 0;">
                    <button id="prevWeekBtn" class="nav-btn" style="background: #3b82f6; border: none; border-radius: 8px; padding: 12px 16px; cursor: pointer; box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3); transition: all 0.2s; color: white;" onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.background='#3b82f6'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(59, 130, 246, 0.3)'">
                        <span style="font-size: 18px; font-weight: bold;">â€¹</span>
                    </button>
                    <button id="todayBtn" class="nav-btn" style="background: #1a2a4d; border: none; border-radius: 8px; padding: 12px 20px; cursor: pointer; box-shadow: 0 2px 4px rgba(26, 42, 77, 0.3); transition: all 0.2s; color: white; font-weight: 500;" onmouseover="this.style.background='#0f1a30'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(26, 42, 77, 0.4)'" onmouseout="this.style.background='#1a2a4d'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(26, 42, 77, 0.3)'">
                        ì˜¤ëŠ˜
                    </button>
                    <button id="nextWeekBtn" class="nav-btn" style="background: #3b82f6; border: none; border-radius: 8px; padding: 12px 16px; cursor: pointer; box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3); transition: all 0.2s; color: white;" onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.background='#3b82f6'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(59, 130, 246, 0.3)'">
                        <span style="font-size: 18px; font-weight: bold;">â€º</span>
                    </button>
                </div>


                <div class="calendar-container">
                    <div class="calendar-wrapper">
                        <div class="calendar-header">
                            <div>ì‹œê°„</div>
                            <div data-day="1" id="day1">ì›”</div>
                            <div data-day="2" id="day2">í™”</div>
                            <div data-day="3" id="day3">ìˆ˜</div>
                            <div data-day="4" id="day4">ëª©</div>
                            <div data-day="5" id="day5">ê¸ˆ</div>
                            <div data-day="6" id="day6">í† </div>
                            <div data-day="7" id="day7">ì¼</div>
                        </div>
                        <div class="calendar-body" id="calendarBody">
                            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>


    <!-- ì™„ì „íˆ ìƒˆë¡œìš´ ì˜ˆì•½ ëª¨ë‹¬ -->
    <div id="reservationModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999999; align-items: center; justify-content: center;">
        <div style="background: white; padding: 45px; border-radius: 15px; max-width: 750px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 15px 45px rgba(0,0,0,0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                <h2 style="margin: 0; color: #333; font-size: 36px;">ìƒˆ ì¼ì •</h2>
                <button onclick="closeModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
            </div>
            
            
            <div style="margin-bottom: 22px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">ì¼ì • ìœ í˜•</label>
                <div style="display: flex; gap: 30px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <input type="radio" name="scheduleType" value="reservation" checked style="transform: scale(1.2);">
                        <span style="color: #333; font-weight: 500;">ì˜ˆì•½</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <input type="radio" name="scheduleType" value="quick" style="transform: scale(1.2);">
                        <span style="color: #333; font-weight: 500;">ë°”ë¡œê°€ì…(ë¹„íšŒì›)</span>
                    </label>
                </div>
            </div>
            
            <div style="margin-bottom: 22px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">ì˜ˆì•½ì¼</label>
                <input type="date" id="reservationDate" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
            </div>
            
            <div style="display: flex; gap: 22px; margin-bottom: 22px;">
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">ì‹œì‘ ì‹œê°„</label>
                    <div style="display: flex; gap: 8px;">
                        <select id="startHour" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                            <option value="07">07ì‹œ</option>
                            <option value="08">08ì‹œ</option>
                            <option value="09">09ì‹œ</option>
                            <option value="10">10ì‹œ</option>
                            <option value="11">11ì‹œ</option>
                            <option value="12">12ì‹œ</option>
                            <option value="13">13ì‹œ</option>
                            <option value="14">14ì‹œ</option>
                            <option value="15">15ì‹œ</option>
                            <option value="16">16ì‹œ</option>
                            <option value="17">17ì‹œ</option>
                            <option value="18">18ì‹œ</option>
                            <option value="19">19ì‹œ</option>
                            <option value="20">20ì‹œ</option>
                            <option value="21">21ì‹œ</option>
                            <option value="22">22ì‹œ</option>
                            <option value="23">23ì‹œ</option>
                            <option value="24">24ì‹œ</option>
                        </select>
                        <select id="startMinute" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                            <option value="00">00ë¶„</option>
                            <option value="30">30ë¶„</option>
                        </select>
                    </div>
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">ì¢…ë£Œ ì‹œê°„</label>
                    <div style="display: flex; gap: 8px;">
                        <select id="endHour" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                            <option value="07">07ì‹œ</option>
                            <option value="08">08ì‹œ</option>
                            <option value="09">09ì‹œ</option>
                            <option value="10">10ì‹œ</option>
                            <option value="11">11ì‹œ</option>
                            <option value="12">12ì‹œ</option>
                            <option value="13">13ì‹œ</option>
                            <option value="14">14ì‹œ</option>
                            <option value="15">15ì‹œ</option>
                            <option value="16">16ì‹œ</option>
                            <option value="17">17ì‹œ</option>
                            <option value="18">18ì‹œ</option>
                            <option value="19">19ì‹œ</option>
                            <option value="20">20ì‹œ</option>
                            <option value="21">21ì‹œ</option>
                            <option value="22">22ì‹œ</option>
                            <option value="23">23ì‹œ</option>
                            <option value="24">24ì‹œ</option>
                        </select>
                        <select id="endMinute" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                            <option value="00">00ë¶„</option>
                            <option value="30">30ë¶„</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 22px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">ê¸°ê¸° ì„ íƒ</label>
                <select id="deviceSelect" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                    <option value="">ê¸°ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</option>
                    <option value="device1">ê¸°ê¸° 1</option>
                    <option value="device2">ê¸°ê¸° 2</option>
                    <option value="device3">ê¸°ê¸° 3</option>
                    <option value="device4">ê¸°ê¸° 4</option>
                </select>
            </div>
            
            <div style="margin-bottom: 22px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">íšŒì› ìœ í˜•</label>
                <div style="display: flex; gap: 30px;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <input type="radio" name="memberType" value="existing" checked style="transform: scale(1.2);">
                        <span style="color: #333; font-weight: 500;">ê¸°ì¡´íšŒì›</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 16px;">
                        <input type="radio" name="memberType" value="quick" style="transform: scale(1.2);">
                        <span style="color: #333; font-weight: 500;">ë°”ë¡œê°€ì…(ë¹„íšŒì›)</span>
                    </label>
                </div>
            </div>
            
            <div style="display: flex; gap: 22px; margin-bottom: 22px;">
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">íšŒì›ì´ë¦„</label>
                    <div style="position: relative;">
                        <input type="text" id="memberSearchInput" placeholder="íšŒì› ì´ë¦„ì„ ê²€ìƒ‰í•˜ì„¸ìš”..." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                        <div id="memberDropdown" style="position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; border-top: none; border-radius: 0 0 6px 6px; max-height: 200px; overflow-y: auto; z-index: 1000; display: none;">
                            <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                    <input type="hidden" id="selectedMemberId" value="">
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">ì—°ë½ì²˜</label>
                    <input type="text" id="contactInput" placeholder="ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
                </div>
            </div>
            
            
            <div style="margin-bottom: 22px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">ìƒí’ˆ</label>
                <input type="text" id="productInput" placeholder="ìƒí’ˆì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px;">
            </div>
            
            <!-- ì‹œí—˜ ì¼ì • ì„¹ì…˜ -->
            <div style="margin-bottom: 22px;">
                <label style="display: block; margin-bottom: 12px; font-weight: bold; color: #333; font-size: 16px;">ì‹œí—˜ ì¼ì •</label>
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 8px; color: #666; font-size: 14px;">ê¸°ëŠ¥ ì‹œí—˜</label>
                        <input type="date" id="functionTestDate" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; background: #f8f9fa; color: #6c757d;">
                    </div>
                    <div style="flex: 1;">
                        <label style="display: block; margin-bottom: 8px; color: #666; font-size: 14px;">ì£¼í–‰ ì‹œí—˜</label>
                        <input type="date" id="roadTestDate" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 16px; background: #f8f9fa; color: #6c757d;">
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 22px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333; font-size: 16px;">ì˜ˆì•½ê´€ë ¨ ë©”ëª¨</label>
                <textarea id="reservationMemo" rows="3" placeholder="ì˜ˆì•½ ê´€ë ¨ ë©”ëª¨ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; resize: vertical; font-size: 16px;"></textarea>
            </div>
            
            <!-- êµìœ¡ ë° ë©”ëª¨ì‚¬í•­ ì„¹ì…˜ -->
            <div style="margin-bottom: 22px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <label style="font-weight: 600; color: #1f2937; font-size: 16px; margin: 0;">êµìœ¡ ë° ë©”ëª¨ì‚¬í•­</label>
                    <button type="button" id="addEducationMemoBtn" style="background: #3b82f6; color: white; border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); transition: all 0.2s;" onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.15)'" onmouseout="this.style.background='#3b82f6'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 2px rgba(0, 0, 0, 0.1)'">+</button>
                </div>
                <div id="educationMemosContainer" style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px;">
                    <!-- êµìœ¡ ë©”ëª¨ í•­ëª©ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <div style="margin-top: 30px; border-top: 1px solid #eee; padding: 22px 20px 0 20px; overflow: hidden;">
                <!-- ìˆ˜ì • ëª¨ë“œ ë²„íŠ¼ë“¤ (ìˆ¨ê¹€) -->
                <div id="editModeButtons" style="display: none; float: right;">
                    <button id="deleteReservationBtn" style="display: inline-block; margin-right: 12px; padding: 15px 30px; background: #dc2626; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;">ì˜ˆì•½ ì‚­ì œ</button>
                    <button id="markAbsentBtn" style="display: inline-block; margin-right: 12px; padding: 15px 30px; background: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;">ê²°ì„</button>
                    <button id="updateReservationBtn" style="display: inline-block; padding: 15px 30px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;">ìˆ˜ì •</button>
                </div>
                
                <!-- ì¼ë°˜ ëª¨ë“œ ë²„íŠ¼ë“¤ -->
                <div id="normalModeButtons" style="float: right;">
                    <button onclick="closeModal()" style="display: inline-block; margin-right: 12px; padding: 15px 30px; background: #6c757d; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;">ì·¨ì†Œ</button>
                    <button onclick="saveReservation('immediate')" style="display: inline-block; margin-right: 12px; padding: 15px 30px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;">ë°”ë¡œ ì˜ˆì•½</button>
                    <button onclick="saveReservation('continue')" style="display: inline-block; padding: 15px 30px; background: #ffc107; color: #212529; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: 500;">ê³„ì† ì˜ˆì•½</button>
                </div>
            </div>
        </div>
    </div>


    <script>
        // ìƒˆë¡œìš´ ì˜ˆì•½ ì‹œìŠ¤í…œ - ê¹”ë”í•˜ê²Œ ì²˜ìŒë¶€í„°
        console.log('ì˜ˆì•½ ì‹œìŠ¤í…œ ì´ˆê¸°í™”');
        
        // ê³„ì† ì˜ˆì•½ì„ ìœ„í•œ ë§ˆì§€ë§‰ íšŒì› ì •ë³´ ì €ì¥
        let lastReservationMember = null;
        
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        window.addEventListener('load', function() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const userRole = localStorage.getItem('userRole');
            
            if (isLoggedIn !== 'true' || userRole !== 'admin') {
                window.location.href = 'login.html';
                return;
            }
            
            // ëª¨ë‹¬ì´ ìë™ìœ¼ë¡œ ì—´ë¦¬ì§€ ì•Šë„ë¡ í™•ì‹¤íˆ ìˆ¨ê¹€
            const modal = document.getElementById('reservationModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('ëª¨ë‹¬ ì´ˆê¸° ìƒíƒœ: ìˆ¨ê¹€');
            }
            
            // ìº˜ë¦°ë” ì´ˆê¸°í™”
            initializeCalendar();
            
            // íšŒì› ëª©ë¡ ë¡œë“œ
            loadMembers();
        });

        // ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userRole');
            window.location.href = 'login.html';
        }

        // í—¤ë” ì˜ì—­ì˜ ì˜ëª»ëœ ì˜ˆì•½ ë¸”ë¡ ì •ë¦¬ í•¨ìˆ˜
        function cleanupHeaderBlocks() {
            // ëª¨ë“  ì˜ˆì•½ ë¸”ë¡ ì œê±° (ì˜ëª»ëœ ìœ„ì¹˜ì— ìˆëŠ” ê²ƒë“¤ í¬í•¨)
            const allBlocks = document.querySelectorAll('.reservation-block');
            if (allBlocks.length > 0) {
                console.log('ëª¨ë“  ì˜ˆì•½ ë¸”ë¡ ì œê±°:', allBlocks.length + 'ê°œ');
                allBlocks.forEach(block => {
                    console.log('ì œê±°í•  ë¸”ë¡:', block);
                    block.remove();
                });
            }
            
            // í—¤ë” ì˜ì—­ì˜ ì˜ˆì•½ ë¸”ë¡ë„ ì œê±°
            const header = document.querySelector('.calendar-header');
            if (header) {
                const headerBlocks = header.querySelectorAll('.reservation-block');
                if (headerBlocks.length > 0) {
                    console.log('í—¤ë” ì˜ì—­ì˜ ì˜ëª»ëœ ì˜ˆì•½ ë¸”ë¡ ì œê±°:', headerBlocks.length + 'ê°œ');
                    headerBlocks.forEach(block => {
                        block.remove();
                    });
                }
            }
        }

        // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì£¼ë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜
        let currentWeekStart = null;

        // í˜„ì¬ ì£¼ì˜ ë‚ ì§œ ë°°ì—´ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        function getCurrentWeek() {
            if (!currentWeekStart) {
                // currentWeekStartê°€ ì—†ìœ¼ë©´ ì˜¤ëŠ˜ ê¸°ì¤€ìœ¼ë¡œ ì£¼ê°„ ë‚ ì§œ ê³„ì‚°
                const today = new Date();
                const currentDay = today.getDay(); // 0(ì¼ìš”ì¼) ~ 6(í† ìš”ì¼)
                const monday = new Date(today);
                monday.setDate(today.getDate() - currentDay + 1);
                
                const weekDates = [];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(monday);
                    date.setDate(monday.getDate() + i);
                    weekDates.push(date);
                }
                return weekDates;
            } else {
                // currentWeekStartê°€ ìˆìœ¼ë©´ ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì£¼ê°„ ë‚ ì§œ ê³„ì‚°
                const weekDates = [];
                for (let i = 0; i < 7; i++) {
                    const date = new Date(currentWeekStart);
                    date.setDate(currentWeekStart.getDate() + i);
                    weekDates.push(date);
                }
                console.log('ğŸ“… getCurrentWeek (currentWeekStart ê¸°ì¤€):', {
                    currentWeekStart: currentWeekStart.toISOString().split('T')[0],
                    weekDates: weekDates.map(d => d.toISOString().split('T')[0])
                });
                return weekDates;
            }
        }

        // í˜„ì¬ ì£¼ì˜ ë‚ ì§œë¥¼ ê³„ì‚°í•˜ê³  ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateWeekDates(weekStart = null) {
            let monday;
            
            if (weekStart) {
                // íŠ¹ì • ì£¼ì˜ ì›”ìš”ì¼ì´ ì£¼ì–´ì¡Œì„ ë•Œ
                monday = new Date(weekStart);
            } else {
                // í˜„ì¬ ì£¼ì˜ ì›”ìš”ì¼ ê³„ì‚°
                const today = new Date();
                const currentDay = today.getDay(); // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
                monday = new Date(today);
                monday.setDate(today.getDate() - currentDay + 1);
            }
            
            // í˜„ì¬ ì£¼ ì‹œì‘ì¼ ì €ì¥
            currentWeekStart = new Date(monday);
            
            // 7ì¼ê°„ì˜ ë‚ ì§œ ë°°ì—´ ìƒì„±
            const weekDates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                weekDates.push(date);
            }
            
            // ìš”ì¼ ì´ë¦„ê³¼ ë‚ ì§œ ì—…ë°ì´íŠ¸
            const dayNames = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
            weekDates.forEach((date, index) => {
                const dayElement = document.getElementById(`day${index + 1}`);
                if (dayElement) {
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    dayElement.textContent = `${dayNames[index]} ${month}/${day}`;
                }
            });
            
            // ì˜ˆì•½ ë‚ ì§œ ì…ë ¥ í•„ë“œë„ ì—…ë°ì´íŠ¸ (ì˜¤ëŠ˜ ë‚ ì§œë¡œ)
            const reservationDateInput = document.getElementById('reservationDate');
            if (reservationDateInput) {
                const today = new Date();
                reservationDateInput.value = today.toISOString().split('T')[0];
            }
            
            return weekDates;
        }

        // ì´ì „ ì£¼ë¡œ ì´ë™
        async function goToPreviousWeek() {
            if (currentWeekStart) {
                const prevWeek = new Date(currentWeekStart);
                prevWeek.setDate(prevWeek.getDate() - 7);
                
                // 1. ìº˜ë¦°ë” í—¤ë” ì—…ë°ì´íŠ¸
                updateWeekDates(prevWeek);
                
                // 2. ì™„ì „íˆ ìƒˆë¡œê³ ì¹¨ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
                console.log('ğŸ”„ ì´ì „ì£¼ë¡œ ì´ë™: ì™„ì „ ìƒˆë¡œê³ ì¹¨');
                
                // 3. ì´ì „ì£¼ë¡œ ì´ë™ ì‹œ ë¹¨ê°„ìƒ‰ ì„ ê³¼ í™”ì‚´í‘œ ì¦‰ì‹œ ìˆ¨ê¹€
                const timeLine = document.querySelector('.current-time-line');
                const timeIndicator = document.querySelector('.current-time-indicator');
                if (timeLine) timeLine.style.display = 'none';
                if (timeIndicator) timeIndicator.style.display = 'none';
                
                // ìº˜ë¦°ë” ì „ì²´ë¥¼ ë‹¤ì‹œ ìƒì„±
                await clearAndReloadCalendar();
                
                // í•´ë‹¹ ì£¼ì˜ ì˜ˆì•½ ë¡œë“œ
                try {
                    const reservations = await loadReservationsFromServer();
                    console.log('ì´ì „ì£¼ ì˜ˆì•½ ìˆ˜:', reservations.length);
                    
                    if (reservations && reservations.length > 0) {
                        for (let index = 0; index < reservations.length; index++) {
                            const reservation = reservations[index];
                            
                            let targetDay = reservation.targetDay || 1;
                            let targetSeat = reservation.targetSeat || 1;
                            
                            if (targetDay < 1 || targetDay > 7) {
                                targetDay = 1;
                            }
                            
                            createReservationBlock(
                                reservation.memberName,
                                reservation.memberId,
                                reservation.memberType,
                                reservation.scheduleType,
                                reservation.startHour,
                                reservation.startMinute,
                                reservation.endHour,
                                reservation.endMinute,
                                reservation.reservationMemo,
                                reservation.educationMemos,
                                reservation.functionTestDate,
                                reservation.roadTestDate,
                                reservation.id,
                                targetDay,
                                targetSeat,
                                reservation.productName,
                                reservation.productHours,
                                reservation.contactPhone
                            );
                        }
                    }
                } catch (error) {
                    console.error('ì˜ˆì•½ ë¡œë“œ ì˜¤ë¥˜:', error);
                }
                
                console.log('âœ… ì´ì „ì£¼ë¡œ ì´ë™ ì™„ë£Œ');
            }
        }

        // ë‹¤ìŒ ì£¼ë¡œ ì´ë™
        async function goToNextWeek() {
            if (currentWeekStart) {
                const nextWeek = new Date(currentWeekStart);
                nextWeek.setDate(nextWeek.getDate() + 7);
                
                // 1. ìº˜ë¦°ë” í—¤ë” ì—…ë°ì´íŠ¸
                updateWeekDates(nextWeek);
                
                // 2. ì™„ì „íˆ ìƒˆë¡œê³ ì¹¨ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
                console.log('ğŸ”„ ë‹¤ìŒì£¼ë¡œ ì´ë™: ì™„ì „ ìƒˆë¡œê³ ì¹¨');
                
                // 3. ë‹¤ìŒì£¼ë¡œ ì´ë™ ì‹œ ë¹¨ê°„ìƒ‰ ì„ ê³¼ í™”ì‚´í‘œ ì¦‰ì‹œ ìˆ¨ê¹€
                const timeLine = document.querySelector('.current-time-line');
                const timeIndicator = document.querySelector('.current-time-indicator');
                if (timeLine) timeLine.style.display = 'none';
                if (timeIndicator) timeIndicator.style.display = 'none';
                
                // ìº˜ë¦°ë” ì „ì²´ë¥¼ ë‹¤ì‹œ ìƒì„±
                await clearAndReloadCalendar();
                
                // í•´ë‹¹ ì£¼ì˜ ì˜ˆì•½ ë¡œë“œ
                try {
                    const reservations = await loadReservationsFromServer();
                    console.log('ë‹¤ìŒì£¼ ì˜ˆì•½ ìˆ˜:', reservations.length);
                    
                    if (reservations && reservations.length > 0) {
                        for (let index = 0; index < reservations.length; index++) {
                            const reservation = reservations[index];
                            
                            let targetDay = reservation.targetDay || 1;
                            let targetSeat = reservation.targetSeat || 1;
                            
                            if (targetDay < 1 || targetDay > 7) {
                                targetDay = 1;
                            }
                            
                            createReservationBlock(
                                reservation.memberName,
                                reservation.memberId,
                                reservation.memberType,
                                reservation.scheduleType,
                                reservation.startHour,
                                reservation.startMinute,
                                reservation.endHour,
                                reservation.endMinute,
                                reservation.reservationMemo,
                                reservation.educationMemos,
                                reservation.functionTestDate,
                                reservation.roadTestDate,
                                reservation.id,
                                targetDay,
                                targetSeat,
                                reservation.productName,
                                reservation.productHours,
                                reservation.contactPhone
                            );
                        }
                    }
                } catch (error) {
                    console.error('ì˜ˆì•½ ë¡œë“œ ì˜¤ë¥˜:', error);
                }
                
                console.log('âœ… ë‹¤ìŒì£¼ë¡œ ì´ë™ ì™„ë£Œ');
            }
        }

        // ìº˜ë¦°ë” ì „ì²´ë¥¼ ì™„ì „íˆ ì§€ìš°ê³  ë‹¤ì‹œ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
        async function clearAndReloadCalendar() {
            console.log('ğŸ”„ ì£¼ê°„ ì´ë™: ìº˜ë¦°ë” ì™„ì „ ì¬ìƒì„±');
            
            // 1. ìº˜ë¦°ë” ë°”ë”” ì™„ì „íˆ ì´ˆê¸°í™”
            const calendarBody = document.getElementById('calendarBody');
            if (calendarBody) {
                calendarBody.innerHTML = '';
            }
            
            // 2. ìº˜ë¦°ë” ë‹¤ì‹œ ìƒì„±
            initializeCalendar();
            
            // 3. ì ì‹œ ëŒ€ê¸°
            await new Promise(resolve => setTimeout(resolve, 100));
            
            console.log('âœ… ìº˜ë¦°ë” ì¬ìƒì„± ì™„ë£Œ');
        }
        
        

        // ì˜¤ëŠ˜ ì£¼ë¡œ ì´ë™
        async function goToToday() {
            console.log('ğŸ”„ ì˜¤ëŠ˜ë¡œ ì´ë™: ì™„ì „ ìƒˆë¡œê³ ì¹¨');
            
            // 1. í˜„ì¬ ì£¼ë¡œ ì„¤ì •
            updateWeekDates(); // í˜„ì¬ ì£¼ë¡œ ì´ë™
            
            // 2. ì˜¤ëŠ˜ë¡œ ì´ë™ ì‹œ ë¹¨ê°„ìƒ‰ ì„ ê³¼ í™”ì‚´í‘œ ë‹¤ì‹œ í‘œì‹œ
            setTimeout(() => {
                updateCurrentTimeLine();
            }, 100);
            
            // 3. ìº˜ë¦°ë” ì „ì²´ë¥¼ ë‹¤ì‹œ ìƒì„±
            await clearAndReloadCalendar();
            
            // 3. í˜„ì¬ ì£¼ì˜ ì˜ˆì•½ ë¡œë“œ
            try {
                const reservations = await loadReservationsFromServer();
                console.log('ì˜¤ëŠ˜ ì£¼ ì˜ˆì•½ ìˆ˜:', reservations.length);
                
                if (reservations && reservations.length > 0) {
                    for (let index = 0; index < reservations.length; index++) {
                        const reservation = reservations[index];
                        
                        let targetDay = reservation.targetDay || 1;
                        let targetSeat = reservation.targetSeat || 1;
                        
                        if (targetDay < 1 || targetDay > 7) {
                            targetDay = 1;
                        }
                        
                        createReservationBlock(
                            reservation.memberName,
                            reservation.memberId,
                            reservation.memberType,
                            reservation.scheduleType,
                            reservation.startHour,
                            reservation.startMinute,
                            reservation.endHour,
                            reservation.endMinute,
                            reservation.reservationMemo,
                            reservation.educationMemos,
                            reservation.functionTestDate,
                            reservation.roadTestDate,
                            reservation.id,
                            targetDay,
                            targetSeat,
                            reservation.productName,
                            reservation.productHours,
                            reservation.contactPhone
                        );
                    }
                }
            } catch (error) {
                console.error('ì˜ˆì•½ ë¡œë“œ ì˜¤ë¥˜:', error);
            }
            
            console.log('âœ… ì˜¤ëŠ˜ë¡œ ì´ë™ ì™„ë£Œ');
        }

        // í˜„ì¬ ì‹œê°„ í‘œì‹œì„  ì—…ë°ì´íŠ¸
        function updateCurrentTimeLine(checkDeduction = true) {
            console.log('ğŸ• updateCurrentTimeLine í˜¸ì¶œë¨, checkDeduction:', checkDeduction);
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // í˜„ì¬ ì£¼ê°€ ì˜¤ëŠ˜ì˜ ì£¼ì¸ì§€ í™•ì¸
            const today = new Date();
            const currentDay = today.getDay();
            const monday = new Date(today);
            monday.setDate(today.getDate() - currentDay + 1);
            
            // ë‚ ì§œ ë¹„êµë¥¼ ìœ„í•´ ì‹œê°„ì„ 0ìœ¼ë¡œ ì„¤ì •
            monday.setHours(0, 0, 0, 0);
            const currentWeekStartNormalized = new Date(currentWeekStart);
            if (currentWeekStartNormalized) {
                currentWeekStartNormalized.setHours(0, 0, 0, 0);
            }
            
            // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì£¼ì™€ ì˜¤ëŠ˜ì˜ ì£¼ ë¹„êµ
            const isCurrentWeek = currentWeekStart && 
                currentWeekStartNormalized.getTime() === monday.getTime();
            
            console.log('í˜„ì¬ ì£¼ì¸ê°€?', isCurrentWeek);
            console.log('í‘œì‹œ ì¤‘ì¸ ì£¼:', currentWeekStart);
            console.log('ì˜¤ëŠ˜ì˜ ì£¼:', monday);
            console.log('ì •ê·œí™”ëœ í‘œì‹œ ì£¼:', currentWeekStartNormalized);
            console.log('ì •ê·œí™”ëœ ì˜¤ëŠ˜ ì£¼:', monday);
            
            // í˜„ì¬ ì£¼ê°€ ì•„ë‹ˆë©´ ë¹¨ê°„ìƒ‰ ì„  ìˆ¨ê¹€ ë° ì°¨ê° ë¡œì§ ì™„ì „ ì¤‘ë‹¨
            if (!isCurrentWeek) {
                const timeLine = document.querySelector('.current-time-line');
                const timeIndicator = document.querySelector('.current-time-indicator');
                if (timeLine) timeLine.style.display = 'none';
                if (timeIndicator) timeIndicator.style.display = 'none';
                console.log('ğŸš« í˜„ì¬ ì£¼ê°€ ì•„ë‹˜ - ì°¨ê° ë¡œì§ ì¤‘ë‹¨');
                return;
            }
            
            // í˜„ì¬ ì‹œê°„ì„ ë¶„ ë‹¨ìœ„ë¡œ ë³€í™˜ (30ë¶„ ì•ìœ¼ë¡œ ì´ë™, í™”ì‚´í‘œ ë†’ì´ ë³´ì •ì„ ìœ„í•´ 4ë¶„ ë’¤ë¡œ)
            const currentTimeInMinutes = currentHour * 60 + currentMinute + 30;
            
            // ë””ë²„ê¹…ìš© ë¡œê·¸
            console.log('í˜„ì¬ ì‹œê°„:', currentHour + ':' + currentMinute);
            console.log('ê³„ì‚°ëœ ì‹œê°„ (ë¶„):', currentTimeInMinutes);
            console.log('ê³„ì‚°ëœ ì‹œê°„ (ì‹œ:ë¶„):', Math.floor(currentTimeInMinutes / 60) + ':' + (currentTimeInMinutes % 60));
            
            // ìº˜ë¦°ë” ì‹œì‘ ì‹œê°„ (9:00 = 540ë¶„)
            const calendarStartMinutes = 9 * 60; // 540ë¶„
            
            // ì‹¤ì œ ìŠ¬ë¡¯ ë†’ì´ ì¸¡ì •
            const timeSlots = document.querySelectorAll('.calendar-body > div');
            let slotHeight = 40; // ê¸°ë³¸ê°’
            
            if (timeSlots.length > 0) {
                // ì²« ë²ˆì§¸ ì‹œê°„ ìŠ¬ë¡¯ì˜ ì‹¤ì œ ë†’ì´ ì¸¡ì •
                const firstSlot = timeSlots[0];
                const slotRect = firstSlot.getBoundingClientRect();
                slotHeight = slotRect.height;
                console.log('ì‹¤ì œ ìŠ¬ë¡¯ ë†’ì´:', slotHeight + 'px');
            }
            
            // í˜„ì¬ ì‹œê°„ì´ ìº˜ë¦°ë” ë²”ìœ„ ë‚´ì— ìˆëŠ”ì§€ í™•ì¸
            if (currentTimeInMinutes >= calendarStartMinutes) {
                // í˜„ì¬ ì‹œê°„ê¹Œì§€ì˜ ë¶„ ìˆ˜
                const minutesFromStart = currentTimeInMinutes - calendarStartMinutes;
                
                // í”½ì…€ ìœ„ì¹˜ ê³„ì‚° (30ë¶„ ë‹¨ìœ„ë¡œ ì •ë ¬)
                // 9:00-9:30=0, 9:30-10:00=1, 10:00-10:30=2, ...
                const slotIndex = Math.floor(minutesFromStart / 30);
                const slotProgress = (minutesFromStart % 30) / 30; // 0-1 ì‚¬ì´ì˜ ê°’
                
                // ë””ë²„ê¹…: ìŠ¬ë¡¯ ì¸ë±ìŠ¤ í™•ì¸
                console.log('ìŠ¬ë¡¯ ì¸ë±ìŠ¤ í•´ì„:', {
                    minutesFromStart,
                    slotIndex,
                    slotProgress,
                    expectedSlot: `${9 + Math.floor(minutesFromStart / 60)}:${(minutesFromStart % 60).toString().padStart(2, '0')}`
                });
                
                // ì •í™•í•œ í”½ì…€ ìœ„ì¹˜ (ìº˜ë¦°ë” ë‚´ë¶€ ê¸°ì¤€)
                const calendarTopPosition = (slotIndex + slotProgress) * slotHeight;
                
                // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
                console.log('minutesFromStart:', minutesFromStart);
                console.log('slotIndex:', slotIndex);
                console.log('slotProgress:', slotProgress);
                console.log('slotHeight:', slotHeight);
                console.log('calendarTopPosition:', calendarTopPosition);
                
                // ìº˜ë¦°ë” ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                const calendarWrapper = document.querySelector('.calendar-wrapper');
                const scrollTop = calendarWrapper ? calendarWrapper.scrollTop : 0;
                const scrollLeft = calendarWrapper ? calendarWrapper.scrollLeft : 0;
                
                // í˜„ì¬ ì‹œê°„ í‘œì‹œì„  ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸
                let timeLine = document.querySelector('.current-time-line');
                let timeIndicator = document.querySelector('.current-time-indicator');
                
                if (!timeLine) {
                    timeLine = document.createElement('div');
                    timeLine.className = 'current-time-line';
                    document.querySelector('.calendar-container').appendChild(timeLine);
                }
                
                if (!timeIndicator) {
                    timeIndicator = document.createElement('div');
                    timeIndicator.className = 'current-time-indicator';
                    document.querySelector('.calendar-container').appendChild(timeIndicator);
                }
                
                // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ê³ ë ¤í•œ ì‹¤ì œ ìœ„ì¹˜ ê³„ì‚°
                const actualTopPosition = calendarTopPosition - scrollTop;
                
                // ì˜¤ëŠ˜ ìš”ì¼ì— ë§ì¶°ì„œ í™”ì‚´í‘œì™€ ì„  ìœ„ì¹˜ ê³„ì‚°
                const today = new Date();
                const todayDay = today.getDay(); // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
                const dayOffset = todayDay === 0 ? 6 : todayDay - 1; // ì›”ìš”ì¼ë¶€í„° ì‹œì‘í•˜ë„ë¡ ì¡°ì •
                const dayWidth = 265; // ê° ìš”ì¼ ì…€ì˜ ë„ˆë¹„ (ì ˆë°˜ ì •ë„ ì™¼ìª½ìœ¼ë¡œ)
                const dayStartPosition = 520; // ì‹œê°„ ì…€ ë„ˆë¹„
                
                // í™”ì‚´í‘œì™€ ì„ ì„ ì˜¤ëŠ˜ ìš”ì¼ ì…€ì— í•¨ê»˜ ìœ„ì¹˜ (4px ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™)
                const arrowLeftPosition = dayStartPosition + (dayOffset * dayWidth) - scrollLeft + 4;
                
                timeIndicator.style.top = `${actualTopPosition - 2}px`; // í™”ì‚´í‘œì™€ ì„ ì´ ê²¹ì¹¨
                timeIndicator.style.left = `${arrowLeftPosition}px`; // ì˜¤ëŠ˜ ìš”ì¼ ì…€
                
                // ì‹œê°„ì„ ë„ í™”ì‚´í‘œì™€ ê°™ì€ ìœ„ì¹˜ë¡œ ì´ë™
                timeLine.style.top = `${actualTopPosition}px`;
                timeLine.style.left = `${arrowLeftPosition}px`; // í™”ì‚´í‘œì™€ ê°™ì€ ìœ„ì¹˜
                
                // í‘œì‹œ
                timeLine.style.display = 'block';
                timeIndicator.style.display = 'block';
                
                // ì‹œê°„ ì°¨ê° ë¡œì§ ì œê±° - ì˜ˆì•½ ì €ì¥ ì‹œì—ë§Œ ì°¨ê°
            } else {
                // í˜„ì¬ ì‹œê°„ì´ ìº˜ë¦°ë” ë²”ìœ„ ë°–ì´ë©´ ìˆ¨ê¹€
                const timeLine = document.querySelector('.current-time-line');
                const timeIndicator = document.querySelector('.current-time-indicator');
                if (timeLine) timeLine.style.display = 'none';
                if (timeIndicator) timeIndicator.style.display = 'none';
            }
        }

        // ê°„ë‹¨í•œ ì‹œê°„ ì°¨ê° í•¨ìˆ˜ - ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì˜ˆì•½ ë¶ˆëŸ¬ì™€ì„œ í˜„ì¬ ì‹œê°„ê³¼ ë¹„êµ
        function checkAndDeductReservationTime() {
            console.log('ğŸ” ê°„ë‹¨í•œ ì‹œê°„ ì°¨ê° ì‹œì‘');
            
            // ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì˜¤ëŠ˜ì˜ ì˜ˆì•½ ë¶ˆëŸ¬ì˜¤ê¸°
            fetch('api/get_today_reservations.php')
            .then(response => response.json())
            .then(result => {
                if (result.success && result.reservations) {
                    console.log('ğŸ“… ì˜¤ëŠ˜ì˜ ì˜ˆì•½ ë¶ˆëŸ¬ì˜´:', result.reservations.length, 'ê°œ');
                    
                    const now = new Date();
                    const today = new Date();
                    today.setHours(0, 0, 0, 0); // ì˜¤ëŠ˜ 00:00:00
                    
                    const currentTimeInMinutes = now.getHours() * 60 + now.getMinutes();
                    
                    result.reservations.forEach(reservation => {
                        // ì˜ˆì•½ ë‚ ì§œê°€ ì˜¤ëŠ˜ì¸ì§€ í™•ì¸
                        const reservationDate = new Date(reservation.reservation_date);
                        reservationDate.setHours(0, 0, 0, 0); // ì˜ˆì•½ì¼ 00:00:00
                        const isToday = (reservationDate.getTime() === today.getTime());
                        
                        const endTimeInMinutes = parseInt(reservation.end_hour) * 60 + parseInt(reservation.end_minute);
                        
                        console.log(`ì˜ˆì•½ ì°¨ê° ì²´í¬: ${reservation.member_name}, ì˜ˆì•½ì¼=${reservation.reservation_date}, ì˜¤ëŠ˜ì˜ˆì•½=${isToday}, í˜„ì¬ì‹œê°„=${currentTimeInMinutes}, ì¢…ë£Œì‹œê°„=${endTimeInMinutes}`);
                        
                        // ì˜¤ëŠ˜ ì˜ˆì•½ì´ê³  í˜„ì¬ ì‹œê°„ì´ ì˜ˆì•½ ì¢…ë£Œ ì‹œê°„ì„ ì§€ë‚¬ìœ¼ë©´ ì°¨ê°
                        if (isToday && currentTimeInMinutes >= endTimeInMinutes) {
                            console.log(`ğŸ’° ${reservation.member_name} íšŒì› ì˜ˆì•½ ì‹œê°„ ì§€ë‚¨ - ì°¨ê° ì‹œì‘`);
                            
                            // ì˜ˆì•½ ì‹œê°„ ê³„ì‚° (30ë¶„ ë‹¨ìœ„)
                            const startTimeInMinutes = parseInt(reservation.start_hour) * 60 + parseInt(reservation.start_minute);
                            const totalMinutes = endTimeInMinutes - startTimeInMinutes;
                            const blocks = Math.ceil(totalMinutes / 30);
                            const hoursToDeduct = blocks * 0.5;
                            
                            // ì°¨ê° API í˜¸ì¶œ (reservation_hours_logì— ê¸°ë¡ ì €ì¥)
                            fetch('api/deduct_reservation_hours.php', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    reservationId: reservation.id,
                                    memberId: reservation.member_id,
                                    hoursToDeduct: hoursToDeduct
                                })
                            }).then(response => response.json())
                            .then(deductResult => {
                                if (deductResult.success) {
                                    console.log(`âœ… ${reservation.member_name} ì°¨ê° ì„±ê³µ: ${hoursToDeduct}ì‹œê°„`);
                                } else {
                                    console.error(`âŒ ${reservation.member_name} ì°¨ê° ì‹¤íŒ¨:`, deductResult.message);
                                }
                            }).catch(error => {
                                console.error(`ğŸ’¥ ${reservation.member_name} ì°¨ê° ì˜¤ë¥˜:`, error);
                            });
                        }
                    });
                }
            })
            .catch(error => {
                console.error('âŒ ì˜ˆì•½ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
            });
        }
        
        // íšŒì›ì˜ ì”ì—¬ì‹œê°„ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateMemberRemainingTime(memberId, newUsedHours) {
            // íšŒì› ëª©ë¡ì—ì„œ í•´ë‹¹ íšŒì› ì°¾ê¸°
            if (typeof allMembers !== 'undefined' && allMembers) {
                const member = allMembers.find(m => m.id == memberId);
                if (member) {
                    // used_hours ì—…ë°ì´íŠ¸
                    member.used_hours = newUsedHours;
                    
                    // ì”ì—¬ì‹œê°„ ê³„ì‚° ë° í‘œì‹œ ì—…ë°ì´íŠ¸
                    const remainingHours = member.product_hours - newUsedHours;
                    const remainingDays = Math.ceil(remainingHours / (member.product_hours / 365)); // ëŒ€ëµì ì¸ ê³„ì‚°
                    
                    console.log(`ğŸ”„ ${member.name} ì”ì—¬ì‹œê°„ ì—…ë°ì´íŠ¸: ${remainingHours}ì‹œê°„ (D-${remainingDays})`);
                    
                    // í™”ë©´ì—ì„œ ì”ì—¬ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸ (ìˆë‹¤ë©´)
                    const memberRow = document.querySelector(`[data-member-id="${memberId}"]`);
                    if (memberRow) {
                        const remainingTimeElement = memberRow.querySelector('.remaining-time');
                        if (remainingTimeElement) {
                            remainingTimeElement.textContent = `D-${remainingDays}/${remainingHours}ì‹œê°„`;
                        }
                    }
                }
            }
        }
        
        // ì°¨ê° ê¸°ë¡ì„ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
        function loadDeductedBlocks() {
            console.log('ğŸ“š ì°¨ê° ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
            fetch('api/save_deduction_record.php')
            .then(response => {
                console.log('API ì‘ë‹µ ìƒíƒœ:', response.status);
                return response.text(); // JSON ëŒ€ì‹  í…ìŠ¤íŠ¸ë¡œ ë¨¼ì € ë°›ê¸°
            })
            .then(text => {
                console.log('API ì‘ë‹µ í…ìŠ¤íŠ¸:', text);
                try {
                    const result = JSON.parse(text);
                    if (result.success && result.deductedBlocks) {
                        deductedBlocks = new Set(result.deductedBlocks);
                        console.log('âœ… ì°¨ê° ê¸°ë¡ ë¡œë“œ ì™„ë£Œ:', deductedBlocks.size, 'ê°œ');
                    } else {
                        console.log('ì°¨ê° ê¸°ë¡ì´ ì—†ê±°ë‚˜ ë¡œë“œ ì‹¤íŒ¨:', result);
                    }
                } catch (parseError) {
                    console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', parseError);
                    console.log('ì›ë³¸ ì‘ë‹µ:', text);
                }
            })
            .catch(error => {
                console.error('âŒ ì°¨ê° ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            });
        }
        
        // ìˆ˜ë™ í…ŒìŠ¤íŠ¸ìš© í•¨ìˆ˜
        function testTimeDeduction() {
            console.log('ğŸ§ª ìˆ˜ë™ ì‹œê°„ ì°¨ê° í…ŒìŠ¤íŠ¸ ì‹œì‘');
            const currentTime = new Date();
            const currentTimeInMinutes = currentTime.getHours() * 60 + currentTime.getMinutes() + 30 - 4;
            console.log('í˜„ì¬ ì‹œê°„ (30ë¶„ ì•, 4ë¶„ ë’¤):', Math.floor(currentTimeInMinutes / 60) + ':' + (currentTimeInMinutes % 60));
            checkAndDeductReservationTime(currentTimeInMinutes);
        }
        
        // ê°•ì œ ì°¨ê° í…ŒìŠ¤íŠ¸ (ëª¨ë“  ì˜ˆì•½ ë¸”ë¡ì— ëŒ€í•´)
        function forceTimeDeduction() {
            console.log('ğŸ”¥ ê°•ì œ ì‹œê°„ ì°¨ê° í…ŒìŠ¤íŠ¸ ì‹œì‘');
            const reservationBlocks = document.querySelectorAll('.reservation-block');
            console.log('ë°œê²¬ëœ ì˜ˆì•½ ë¸”ë¡ ìˆ˜:', reservationBlocks.length);
            
            reservationBlocks.forEach((block, index) => {
                const memberId = block.getAttribute('data-member-id');
                const memberName = block.textContent || 'ì•Œ ìˆ˜ ì—†ìŒ';
                const memberType = block.getAttribute('data-member-type');
                const productHours = parseInt(block.getAttribute('data-product-hours')) || 0;
                
                console.log(`ë¸”ë¡ ${index + 1}: ${memberName} (ID: ${memberId}, íƒ€ì…: ${memberType}, ì‹œê°„: ${productHours})`);
                
                if (memberId && memberType !== 'quick' && productHours > 0) {
                    // ê°•ì œë¡œ 30ë¶„ ì°¨ê°
                    fetch('api/simple_deduct_hours.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            memberId: memberId,
                            hoursToDeduct: 0.5
                        })
                    }).then(response => response.json())
                    .then(result => {
                        console.log(`âœ… ${memberName} ê°•ì œ ì°¨ê° ê²°ê³¼:`, result);
                        if (result.success) {
                            updateMemberRemainingTime(memberId, result.new_used_hours);
                        }
                    }).catch(error => {
                        console.error(`âŒ ${memberName} ì°¨ê° ì˜¤ë¥˜:`, error);
                    });
                }
            });
        }

        // íšŒì›ì˜ ì´ìš©ì‹œê°„ì„ ì°¨ê°í•˜ëŠ” í•¨ìˆ˜
        function deductMemberHours(memberId, hoursToDeduct, reservationId, memberName = 'ì•Œ ìˆ˜ ì—†ìŒ') {
            console.log('ğŸš€ API í˜¸ì¶œ ì‹œì‘:', {
                íšŒì›ì´ë¦„: memberName,
                íšŒì›ID: memberId,
                ì°¨ê°ì‹œê°„: hoursToDeduct,
                ì˜ˆì•½ID: reservationId,
                url: 'api/deduct_member_hours.php'
            });
            
            fetch('api/deduct_member_hours.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    memberId: memberId,
                    hoursToDeduct: hoursToDeduct,
                    reservationId: reservationId
                })
            })
            .then(response => {
                return response.json();
            })
            .then(result => {
                if (result.success) {
                } else {
                    console.error('âŒ ì´ìš©ì‹œê°„ ì°¨ê° ì‹¤íŒ¨:', result.message);
                }
            })
            .catch(error => {
                console.error('ğŸ’¥ ì´ìš©ì‹œê°„ ì°¨ê° ì¤‘ ì˜¤ë¥˜:', error);
            });
        }

        // í…ŒìŠ¤íŠ¸ìš©: ìˆ˜ë™ìœ¼ë¡œ ì‹œê°„ ì°¨ê° í…ŒìŠ¤íŠ¸
        function testTimeDeduction() {
            console.log('ğŸ§ª ìˆ˜ë™ ì‹œê°„ ì°¨ê° í…ŒìŠ¤íŠ¸ ì‹œì‘');
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentTimeInMinutes = currentHour * 60 + currentMinute;
            
            // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í˜„ì¬ ì‹œê°„ì„ 1ì‹œê°„ í›„ë¡œ ì„¤ì •
            const testTimeInMinutes = currentTimeInMinutes + 60;
            
            console.log('í…ŒìŠ¤íŠ¸ ì‹œê°„:', Math.floor(testTimeInMinutes / 60) + ':' + (testTimeInMinutes % 60));
            checkAndDeductReservationTime(testTimeInMinutes);
        }

        // ë„¤ë¹„ê²Œì´ì…˜ í† ê¸€ ê¸°ëŠ¥
        document.addEventListener('DOMContentLoaded', function() {
            // ëª¨ë‹¬ì´ ìë™ìœ¼ë¡œ ì—´ë¦¬ì§€ ì•Šë„ë¡ í™•ì‹¤íˆ ìˆ¨ê¹€
            const modal = document.getElementById('reservationModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('DOMContentLoaded: ëª¨ë‹¬ ìˆ¨ê¹€ ì²˜ë¦¬');
            }
            
            // ë‚ ì§œ ì—…ë°ì´íŠ¸
            updateWeekDates();
            
            // ì£¼ê°„ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const prevWeekBtn = document.getElementById('prevWeekBtn');
            const nextWeekBtn = document.getElementById('nextWeekBtn');
            const todayBtn = document.getElementById('todayBtn');
            
            if (prevWeekBtn) {
                prevWeekBtn.addEventListener('click', goToPreviousWeek);
            }
            if (nextWeekBtn) {
                nextWeekBtn.addEventListener('click', goToNextWeek);
            }
            if (todayBtn) {
                todayBtn.addEventListener('click', goToToday);
            }
            
            // í—¤ë” ì˜ì—­ ì •ë¦¬
            cleanupHeaderBlocks();
            
            // ìº˜ë¦°ë” ì´ˆê¸°í™” (ì˜ˆì•½ ë°ì´í„° ë¡œë“œ í¬í•¨)
            initializeCalendar();
            
            // í˜„ì¬ ì‹œê°„ í‘œì‹œì„  ì´ˆê¸°í™” ë° ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            updateCurrentTimeLine();
            setInterval(() => {
                // í˜„ì¬ ì£¼ì¸ì§€ í™•ì¸ í›„ì—ë§Œ ì—…ë°ì´íŠ¸
                const today = new Date();
                const currentDay = today.getDay();
                const monday = new Date(today);
                monday.setDate(today.getDate() - currentDay + 1);
                monday.setHours(0, 0, 0, 0);
                const currentWeekStartNormalized = new Date(currentWeekStart);
                if (currentWeekStartNormalized) {
                    currentWeekStartNormalized.setHours(0, 0, 0, 0);
                }
                const isCurrentWeek = currentWeekStart && 
                    currentWeekStartNormalized.getTime() === monday.getTime();
                
                if (isCurrentWeek) {
                    updateCurrentTimeLine();
                } else {
                    console.log('ğŸš« ë‹¤ìŒì£¼/ì´ì „ì£¼ - ì°¨ê° ë¡œì§ ì‹¤í–‰ ì•ˆí•¨');
                }
            }, 60000); // 1ë¶„ë§ˆë‹¤ ì—…ë°ì´íŠ¸
            
            // ìŠ¤í¬ë¡¤ ì‹œ í˜„ì¬ ì‹œê°„ í‘œì‹œì„  ì—…ë°ì´íŠ¸ (ì‹œê°„ ì°¨ê° ì œì™¸)
            const calendarWrapper = document.querySelector('.calendar-wrapper');
            if (calendarWrapper) {
                calendarWrapper.addEventListener('scroll', function() {
                    updateCurrentTimeLine(false); // ì‹œê°„ ì°¨ê° ì²´í¬ ì œì™¸
                });
            }
            
            const navParents = document.querySelectorAll('.nav__parent');
            navParents.forEach(parent => {
                parent.addEventListener('click', function() {
                    const children = this.nextElementSibling;
                    if (children) {
                        children.style.display = children.style.display === 'none' ? 'grid' : 'none';
                        this.classList.toggle('active');
                    }
                });
            });
            
            // ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ë“¤ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ë„ë¡ ë³´ì¥
            const navLinks = document.querySelectorAll('.nav__child, .nav__item');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    const href = this.getAttribute('href');
                    console.log('ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ í´ë¦­:', href);
                    
                    // hrefê°€ #ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ í˜ì´ì§€ ì´ë™
                    if (href && href !== '#') {
                        e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
                        console.log('í˜ì´ì§€ ì´ë™:', href);
                        window.location.href = href; // ì§ì ‘ í˜ì´ì§€ ì´ë™
                    }
                });
            });
        });

        // íšŒì› ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        function loadMembers() {
            console.log('íšŒì› ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
            
            fetch('api/get_members.php')
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        console.log('íšŒì› ë°ì´í„° ë¡œë“œ ì„±ê³µ:', result.members.length + 'ëª…');
                        updateMemberSelect(result.members);
                    } else {
                        console.error('íšŒì› ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', result.message);
                        updateMemberSelect([]);
                    }
                })
                .catch(error => {
                    console.error('íšŒì› ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                    updateMemberSelect([]);
                });
        }

        // ì „ì—­ ë³€ìˆ˜ë¡œ íšŒì› ë°ì´í„° ì €ì¥
        let allMembers = [];

        // íšŒì› ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê²€ìƒ‰ ê¸°ëŠ¥ìœ¼ë¡œ ë³€ê²½)
        function updateMemberSelect(members) {
            allMembers = members; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            console.log('íšŒì› ë°ì´í„° ì €ì¥ ì™„ë£Œ:', members.length + 'ëª…');
        }

        // íšŒì› ê²€ìƒ‰ í•¨ìˆ˜
        function searchMembers() {
            const searchInput = document.getElementById('memberSearchInput');
            const dropdown = document.getElementById('memberDropdown');
            const searchTerm = searchInput.value.toLowerCase().trim();

            if (!dropdown) return;

            // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            if (!searchTerm) {
                dropdown.style.display = 'none';
                return;
            }

            // íšŒì› ê²€ìƒ‰
            const filteredMembers = allMembers.filter(member => 
                member.name.toLowerCase().includes(searchTerm) ||
                (member.phone && member.phone.includes(searchTerm))
            );

            // ë“œë¡­ë‹¤ìš´ ë‚´ìš© ì—…ë°ì´íŠ¸
            dropdown.innerHTML = '';
            
            if (filteredMembers.length === 0) {
                const noResult = document.createElement('div');
                noResult.style.padding = '12px';
                noResult.style.color = '#666';
                noResult.textContent = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
                dropdown.appendChild(noResult);
            } else {
                filteredMembers.forEach(member => {
                    const memberItem = document.createElement('div');
                    memberItem.style.padding = '12px';
                    memberItem.style.cursor = 'pointer';
                    memberItem.style.borderBottom = '1px solid #eee';
                    memberItem.innerHTML = `
                        <div style="font-weight: bold; color: #333;">${member.name}</div>
                        <div style="font-size: 14px; color: #666;">${member.product_name || member.product || 'ìƒí’ˆ ì •ë³´ ì—†ìŒ'}</div>
                    `;
                    
                    memberItem.addEventListener('click', function() {
                        selectMember(member);
                    });
                    
                    memberItem.addEventListener('mouseenter', function() {
                        this.style.backgroundColor = '#f5f5f5';
                    });
                    
                    memberItem.addEventListener('mouseleave', function() {
                        this.style.backgroundColor = 'white';
                    });
                    
                    dropdown.appendChild(memberItem);
                });
            }

            dropdown.style.display = 'block';
        }

        // íšŒì› ì„ íƒ í•¨ìˆ˜
        function selectMember(member) {
            const searchInput = document.getElementById('memberSearchInput');
            const dropdown = document.getElementById('memberDropdown');
            const selectedMemberId = document.getElementById('selectedMemberId');
            const contactInput = document.getElementById('contactInput');

            // ì…ë ¥ í•„ë“œì— íšŒì› ì´ë¦„ í‘œì‹œ
            searchInput.value = member.name;
            
            // ìˆ¨ê²¨ì§„ í•„ë“œì— íšŒì› ID ì €ì¥
            selectedMemberId.value = member.id;
            
            // ì—°ë½ì²˜ ìë™ ì…ë ¥
            contactInput.value = member.phone || '';
            
            // ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            dropdown.style.display = 'none';
            
            // íšŒì› ìƒì„¸ ì •ë³´ ë¡œë“œ
            loadMemberDetail(member.id);
            
            console.log('íšŒì› ì„ íƒë¨:', member.name, member.id);
        }

        // íšŒì› ê²€ìƒ‰ ì´ë²¤íŠ¸ ì„¤ì •
        function setupMemberSelectEvent() {
            const searchInput = document.getElementById('memberSearchInput');
            const dropdown = document.getElementById('memberDropdown');
            const contactInput = document.getElementById('contactInput');
            const memberDetailInfo = document.getElementById('memberDetailInfo');
            const productInput = document.getElementById('productInput');
            
            if (searchInput) {
                // ì…ë ¥ ì‹œ ê²€ìƒ‰ ì‹¤í–‰ (ê¸°ì¡´íšŒì›ì¼ ë•Œë§Œ)
                searchInput.addEventListener('input', function() {
                    const memberType = document.querySelector('input[name="memberType"]:checked');
                    if (memberType && memberType.value === 'existing') {
                        searchMembers();
                    } else if (memberType && memberType.value === 'quick') {
                        // ë¹„íšŒì›ì¼ ë•ŒëŠ” ê²€ìƒ‰í•˜ì§€ ì•Šê³  ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
                        if (dropdown) dropdown.style.display = 'none';
                    }
                });
                
                // í¬ì»¤ìŠ¤ ì‹œ ë“œë¡­ë‹¤ìš´ í‘œì‹œ (ê¸°ì¡´íšŒì›ì¼ ë•Œë§Œ)
                searchInput.addEventListener('focus', function() {
                    const memberType = document.querySelector('input[name="memberType"]:checked');
                    if (memberType && memberType.value === 'existing' && this.value.trim()) {
                        searchMembers();
                    } else if (memberType && memberType.value === 'quick') {
                        // ë¹„íšŒì›ì¼ ë•ŒëŠ” ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
                        if (dropdown) dropdown.style.display = 'none';
                    }
                });
                
                // í¬ì»¤ìŠ¤ ì•„ì›ƒ ì‹œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€ (ì•½ê°„ì˜ ì§€ì—°)
                searchInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        if (dropdown) {
                            dropdown.style.display = 'none';
                        }
                    }, 200);
                });
            }
            
            // ì™¸ë¶€ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ìˆ¨ê¹€
            document.addEventListener('click', function(e) {
                if (dropdown && !searchInput.contains(e.target) && !dropdown.contains(e.target)) {
                    dropdown.style.display = 'none';
                }
            });
            
            // íšŒì› ìœ í˜• ë³€ê²½ ì´ë²¤íŠ¸
            const memberTypeRadios = document.querySelectorAll('input[name="memberType"]');
            memberTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    handleMemberTypeChange(this.value);
                });
            });
            
            // ì¼ì • ìœ í˜• ë³€ê²½ ì´ë²¤íŠ¸ (ë°”ë¡œê°€ì…(ë¹„íšŒì›) ì„ íƒ ì‹œ íšŒì› ìœ í˜•ë„ ìë™ ë³€ê²½)
            const scheduleTypeRadios = document.querySelectorAll('input[name="scheduleType"]');
            scheduleTypeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'quick') {
                        // ë°”ë¡œê°€ì…(ë¹„íšŒì›) ì„ íƒ ì‹œ íšŒì› ìœ í˜•ë„ ë°”ë¡œê°€ì…(ë¹„íšŒì›)ìœ¼ë¡œ ë³€ê²½
                        const quickMemberType = document.querySelector('input[name="memberType"][value="quick"]');
                        if (quickMemberType) {
                            quickMemberType.checked = true;
                            handleMemberTypeChange('quick');
                        }
                    }
                });
            });
        }
        
        // íšŒì› ìœ í˜• ë³€ê²½ ì²˜ë¦¬
        function handleMemberTypeChange(memberType, preserveValues = false) {
            const searchInput = document.getElementById('memberSearchInput');
            const dropdown = document.getElementById('memberDropdown');
            const contactInput = document.getElementById('contactInput');
            const productInput = document.getElementById('productInput');
            const selectedMemberId = document.getElementById('selectedMemberId');
            
            // ê³„ì† ì˜ˆì•½ ëª¨ë“œê°€ ì•„ë‹ˆë©´ í•„ë“œ ì´ˆê¸°í™”
            if (!preserveValues) {
                if (searchInput) searchInput.value = '';
                if (contactInput) contactInput.value = '';
                if (productInput) productInput.value = '';
                if (selectedMemberId) selectedMemberId.value = '';
            }
            if (dropdown) dropdown.style.display = 'none';
            
            // íšŒì› ìƒì„¸ ì •ë³´ ìˆ¨ê¸°ê¸°
            hideMemberDetail();
            
            if (memberType === 'quick') {
                // ë¹„íšŒì›: ê²€ìƒ‰ ê¸°ëŠ¥ ë¹„í™œì„±í™”, ì…ë ¥ë§Œ ê°€ëŠ¥
                if (searchInput) {
                    searchInput.placeholder = 'íšŒì› ì´ë¦„ì„ ì‘ì„±í•´ì£¼ì„¸ìš”';
                    searchInput.readOnly = false;
                }
                console.log('ë¹„íšŒì› ëª¨ë“œë¡œ ì „í™˜');
            } else {
                // ê¸°ì¡´íšŒì›: ê²€ìƒ‰ ê¸°ëŠ¥ í™œì„±í™”
                if (searchInput) {
                    searchInput.placeholder = 'íšŒì›ì„ ê²€ìƒ‰í•˜ì„¸ìš”';
                    searchInput.readOnly = false;
                }
                console.log('ê¸°ì¡´íšŒì› ëª¨ë“œë¡œ ì „í™˜');
            }
        }

        // íšŒì› ìƒì„¸ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
        function loadMemberDetail(memberId) {
            console.log('íšŒì› ìƒì„¸ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°:', memberId);
            
            fetch(`api/debug_member_detail.php?id=${memberId}`)
                .then(response => {
                    console.log('API ì‘ë‹µ ìƒíƒœ:', response.status);
                    return response.json();
                })
                .then(result => {
                    console.log('API ì‘ë‹µ ë°ì´í„°:', result);
                    if (result.success) {
                        console.log('íšŒì› ìƒì„¸ ì •ë³´ ë¡œë“œ ì„±ê³µ:', result.member);
                        console.log('ìƒí’ˆ ì •ë³´ í™•ì¸:', {
                            productName: result.member.productName,
                            product_name: result.member.product_name,
                            product: result.member.product
                        });
                        displayMemberDetail(result.member);
                    } else {
                        console.error('íšŒì› ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', result.message);
                        hideMemberDetail();
                    }
                })
                .catch(error => {
                    console.error('íšŒì› ìƒì„¸ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
                    hideMemberDetail();
                });
        }

        // íšŒì› ìƒì„¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
        function displayMemberDetail(member) {
            console.log('íšŒì› ìƒì„¸ ì •ë³´ í‘œì‹œ:', member);
            
            const productInput = document.getElementById('productInput');
            const contactInput = document.getElementById('contactInput');
            
            // ì‹œí—˜ ì¼ì • ë¡œë“œ
            loadTestSchedule(member);
            
            // êµìœ¡ ë©”ëª¨ ë¡œë“œ
            console.log('êµìœ¡ ë©”ëª¨ ë°ì´í„° í™•ì¸:', {
                education_memos: member.education_memos,
                type: typeof member.education_memos,
                length: member.education_memos ? member.education_memos.length : 0
            });
            
            if (member.education_memos && Array.isArray(member.education_memos) && member.education_memos.length > 0) {
                console.log('êµìœ¡ ë©”ëª¨ ë¡œë“œ ì„±ê³µ:', member.education_memos);
                loadEducationMemos(member.education_memos);
            } else {
                console.log('êµìœ¡ ë©”ëª¨ê°€ ì—†ê±°ë‚˜ ë¹„ì–´ìˆìŒ');
                clearEducationMemos();
            }
            
            // ìƒí’ˆ ì…ë ¥ í•„ë“œì— íšŒì›ì˜ ìƒí’ˆëª… ìë™ ì…ë ¥
            if (productInput) {
                const productName = member.productName || member.product_name || member.product;
                console.log('ìƒí’ˆ ì •ë³´ ì„¤ì •:', {
                    productName: member.productName,
                    product_name: member.product_name,
                    product: member.product,
                    ìµœì¢…ì‚¬ìš©ê°’: productName
                });
                
                // ìƒí’ˆ ì •ë³´ê°€ ìˆì„ ë•Œë§Œ ì„¤ì •
                if (productName && productName.trim() !== '' && productName !== 'ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš”') {
                    productInput.value = productName;
                    console.log('ìƒí’ˆ ì •ë³´ ì„¤ì •ë¨:', productName);
                } else {
                    console.log('ìƒí’ˆ ì •ë³´ê°€ ì—†ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŒ:', productName);
                    // ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •í•˜ì§€ ì•ŠìŒ
                }
            } else {
                console.error('productInput ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            // ì—°ë½ì²˜ í•„ë“œì— íšŒì›ì˜ ì „í™”ë²ˆí˜¸ ìë™ ì…ë ¥
            if (contactInput && member.phone) {
                contactInput.value = member.phone;
            }
            
            console.log('íšŒì› ìƒì„¸ ì •ë³´ ë¡œë“œ ì™„ë£Œ');
        }
        
        // ì‹œí—˜ ì¼ì • ë¡œë“œ í•¨ìˆ˜
        function loadTestSchedule(member) {
            const functionTestDate = document.getElementById('functionTestDate');
            const roadTestDate = document.getElementById('roadTestDate');
            
            if (functionTestDate && roadTestDate) {
                // ê¸°ëŠ¥ ì‹œí—˜ ì¼ì • ì„¤ì •
                if (member.indoorTestDate && member.indoorTestDate !== '-') {
                    functionTestDate.value = member.indoorTestDate;
                    functionTestDate.style.background = '#fff';
                    functionTestDate.style.color = '#333';
                } else {
                    functionTestDate.value = '';
                    functionTestDate.style.background = '#f8f9fa';
                    functionTestDate.style.color = '#6c757d';
                }
                
                // ì£¼í–‰ ì‹œí—˜ ì¼ì • ì„¤ì •
                if (member.roadTestDate && member.roadTestDate !== '-') {
                    roadTestDate.value = member.roadTestDate;
                    roadTestDate.style.background = '#fff';
                    roadTestDate.style.color = '#333';
                } else {
                    roadTestDate.value = '';
                    roadTestDate.style.background = '#f8f9fa';
                    roadTestDate.style.color = '#6c757d';
                }
            }
        }

        // íšŒì› ìƒì„¸ ì •ë³´ ìˆ¨ê¸°ê¸° í•¨ìˆ˜
        function hideMemberDetail() {
            // ì‹œí—˜ ì¼ì • í•„ë“œ ì´ˆê¸°í™”
            const functionTestDate = document.getElementById('functionTestDate');
            const roadTestDate = document.getElementById('roadTestDate');
            
            if (functionTestDate) {
                functionTestDate.value = '';
                functionTestDate.style.background = '#f8f9fa';
                functionTestDate.style.color = '#6c757d';
            }
            
            if (roadTestDate) {
                roadTestDate.value = '';
                roadTestDate.style.background = '#f8f9fa';
                roadTestDate.style.color = '#6c757d';
            }
            
            // ì—°ë½ì²˜ í•„ë“œ ì´ˆê¸°í™”
            const contactInput = document.getElementById('contactInput');
            if (contactInput) {
                contactInput.value = '';
            }
        }

        // êµìœ¡ ë©”ëª¨ ì¶”ê°€ ê¸°ëŠ¥
        function setupEducationMemoFeature() {
            const addBtn = document.getElementById('addEducationMemoBtn');
            const container = document.getElementById('educationMemosContainer');
            
            if (addBtn && container) {
                // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
                addBtn.removeEventListener('click', handleAddEducationMemo);
                
                // ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
                addBtn.addEventListener('click', handleAddEducationMemo);
            }
        }
        
        // êµìœ¡ ë©”ëª¨ ì¶”ê°€ í•¸ë“¤ëŸ¬ (ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬)
        function handleAddEducationMemo() {
            addEducationMemoItem();
        }

        // ì‹œí—˜ ì¼ì • í•„ë“œ ì´ë²¤íŠ¸ ì„¤ì •
        function setupTestScheduleFields() {
            const functionTestDate = document.getElementById('functionTestDate');
            const roadTestDate = document.getElementById('roadTestDate');
            
            // ê¸°ëŠ¥ ì‹œí—˜ í•„ë“œ ì´ë²¤íŠ¸
            if (functionTestDate) {
                functionTestDate.addEventListener('focus', function() {
                    this.style.background = '#fff';
                    this.style.color = '#333';
                });
                
                functionTestDate.addEventListener('blur', function() {
                    if (!this.value) {
                        this.style.background = '#f8f9fa';
                        this.style.color = '#6c757d';
                    }
                });
            }
            
            // ì£¼í–‰ ì‹œí—˜ í•„ë“œ ì´ë²¤íŠ¸
            if (roadTestDate) {
                roadTestDate.addEventListener('focus', function() {
                    this.style.background = '#fff';
                    this.style.color = '#333';
                });
                
                roadTestDate.addEventListener('blur', function() {
                    if (!this.value) {
                        this.style.background = '#f8f9fa';
                        this.style.color = '#6c757d';
                    }
                });
            }
        }

        // êµìœ¡ ë©”ëª¨ í•­ëª© ì¶”ê°€
        function addEducationMemoItem() {
            const container = document.getElementById('educationMemosContainer');
            if (!container) return;

            // í˜„ì¬ ì˜ˆì•½ì˜ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •
            let dateStr = new Date().toISOString().split('T')[0]; // ê¸°ë³¸ê°’: ì˜¤ëŠ˜
            
            // ì˜ˆì•½ ëª¨ë‹¬ì—ì„œ í˜„ì¬ ì„ íƒëœ ë‚ ì§œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const modal = document.getElementById('reservationModal');
            if (modal) {
                const reservationData = currentReservationData || JSON.parse(modal.getAttribute('data-reservation') || '{}');
                
                // ì‹¤ì œ ë‚ ì§œê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ targetDayë¡œ ê³„ì‚°
                
                if (reservationData.actualDate) {
                    dateStr = reservationData.actualDate;
                } else if (reservationData.targetDay !== undefined) {
                    // targetDayëŠ” 0(ì›”ìš”ì¼)ë¶€í„° 6(ì¼ìš”ì¼)ê¹Œì§€ì˜ ê°’
                    const currentWeek = getCurrentWeek();
                    const targetDate = new Date(currentWeek[reservationData.targetDay]);
                    dateStr = targetDate.toISOString().split('T')[0];
                } else {
                    // targetDayë„ ì—†ìœ¼ë©´ í˜„ì¬ ì£¼ì˜ ìš”ì¼ì„ ì¶”ì •í•´ì„œ ê³„ì‚°
                    
                    // í˜„ì¬ ì£¼ì˜ ë‚ ì§œë“¤ì„ í™•ì¸í•˜ì—¬ ê°€ì¥ ê°€ê¹Œìš´ ë‚ ì§œ ì‚¬ìš©
                    const currentWeek = getCurrentWeek();
                    const today = new Date();
                    const todayStr = today.toISOString().split('T')[0];
                    
                    // í˜„ì¬ ì£¼ì—ì„œ ì˜¤ëŠ˜ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ë‚ ì§œ ì°¾ê¸°
                    let closestDate = null;
                    let minDiff = Infinity;
                    
                    currentWeek.forEach((date, index) => {
                        const dateStr = date.toISOString().split('T')[0];
                        const diff = Math.abs(new Date(dateStr) - new Date(todayStr));
                        if (diff < minDiff) {
                            minDiff = diff;
                            closestDate = dateStr;
                        }
                    });
                    
                    if (closestDate) {
                        dateStr = closestDate;
                    } else {
                    }
                }
            } else {
            }
            
            const memoItem = document.createElement('div');
            memoItem.className = 'education-memo-item';
            memoItem.style.cssText = `
                background: white;
                border: 1px solid #e5e7eb;
                border-radius: 12px;
                padding: 16px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                transition: all 0.2s ease;
            `;
            
            memoItem.innerHTML = `
                <div style="display: flex; gap: 12px; align-items: flex-start;">
                    <input type="date" value="${dateStr}" style="flex: 0 0 140px; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background: #f9fafb; color: #374151; font-weight: 500;">
                    <textarea placeholder="êµìœ¡ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." style="flex: 1; padding: 10px 12px; border: 2px solid #000; border-radius: 8px; font-size: 14px; resize: vertical; min-height: 80px; font-family: inherit; line-height: 1.5; background: white; color: #111827;"></textarea>
                    <div style="display: flex; gap: 8px; flex-direction: column;">
                        <button type="button" onclick="saveEducationMemoItem(this)" style="background: #10b981; color: white; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);" onmouseover="this.style.background='#059669'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.15)'" onmouseout="this.style.background='#10b981'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 2px rgba(0, 0, 0, 0.1)'">ì €ì¥</button>
                        <button type="button" onclick="removeEducationMemoItem(this)" style="background: #ef4444; color: white; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);" onmouseover="this.style.background='#dc2626'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.15)'" onmouseout="this.style.background='#ef4444'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 2px rgba(0, 0, 0, 0.1)'">ì‚­ì œ</button>
                    </div>
                </div>
            `;
            
            container.appendChild(memoItem);
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
            container.scrollTop = container.scrollHeight;
        }

        // êµìœ¡ ë©”ëª¨ í•­ëª© ì‚­ì œ
        window.removeEducationMemoItem = function(button) {
            const memoItem = button.closest('.education-memo-item');
            if (!memoItem) return;

            // í˜„ì¬ ì˜ˆì•½ ë°ì´í„°ì—ì„œ íšŒì› ID ê°€ì ¸ì˜¤ê¸°
            const modal = document.getElementById('reservationModal');
            const reservationData = currentReservationData || JSON.parse(modal.getAttribute('data-reservation') || '{}');
            
            console.log('ì‚­ì œ ì‹œ ì˜ˆì•½ ë°ì´í„°:', reservationData);
            
            // ì—¬ëŸ¬ í•„ë“œì—ì„œ íšŒì› ID ì°¾ê¸°
            const memberId = reservationData.memberId || reservationData.member_id || 
                           document.getElementById('selectedMemberId')?.value;

            console.log('ì°¾ì€ íšŒì› ID:', memberId);

            if (!memberId) {
                alert('íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜ˆì•½ ëª¨ë‹¬ì„ ë‹¤ì‹œ ì—´ì–´ì£¼ì„¸ìš”.');
                return;
            }

            // í˜„ì¬ êµìœ¡ ë©”ëª¨ ëª©ë¡ì—ì„œ ì‚­ì œí•  í•­ëª©ì˜ ì¸ë±ìŠ¤ ì°¾ê¸°
            const memoItems = document.querySelectorAll('.education-memo-item');
            const currentIndex = Array.from(memoItems).indexOf(memoItem);
            
            if (currentIndex === -1) {
                console.error('ì‚­ì œí•  ë©”ëª¨ í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // í˜„ì¬ êµìœ¡ ë©”ëª¨ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const currentMemos = getEducationMemos();
            
            // í•´ë‹¹ ì¸ë±ìŠ¤ì˜ ë©”ëª¨ ì œê±°
            if (currentIndex < currentMemos.length) {
                currentMemos.splice(currentIndex, 1);
                
                // ì„œë²„ì— ì—…ë°ì´íŠ¸ëœ êµìœ¡ ë©”ëª¨ ëª©ë¡ ì €ì¥
                updateMemberEducationMemos(memberId, currentMemos)
                    .then(() => {
                        // ì„œë²„ ì €ì¥ ì„±ê³µ í›„ UIì—ì„œ ì œê±°
                        memoItem.remove();
                        console.log('êµìœ¡ ë©”ëª¨ ì‚­ì œ ì™„ë£Œ');
                    })
                    .catch(error => {
                        console.error('êµìœ¡ ë©”ëª¨ ì‚­ì œ ì‹¤íŒ¨:', error);
                        alert('êµìœ¡ ë©”ëª¨ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    });
            } else {
                // ì¸ë±ìŠ¤ê°€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©´ UIì—ì„œë§Œ ì œê±°
                memoItem.remove();
            }
        };

        // êµìœ¡ ë©”ëª¨ í•­ëª© ì €ì¥
        window.saveEducationMemoItem = function(button) {
            const memoItem = button.closest('.education-memo-item');
            if (!memoItem) return;

            const dateInput = memoItem.querySelector('input[type="date"]');
            const textarea = memoItem.querySelector('textarea');
            
            if (!dateInput || !textarea) {
                alert('ë‚ ì§œì™€ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const date = dateInput.value;
            const content = textarea.value.trim();

            if (!date || !content) {
                alert('ë‚ ì§œì™€ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // í˜„ì¬ ì˜ˆì•½ ë°ì´í„°ì—ì„œ íšŒì› ID ê°€ì ¸ì˜¤ê¸°
            const modal = document.getElementById('reservationModal');
            const reservationData = currentReservationData || JSON.parse(modal.getAttribute('data-reservation') || '{}');
            
            console.log('ì €ì¥ ì‹œ ì˜ˆì•½ ë°ì´í„°:', reservationData);
            
            // ì—¬ëŸ¬ í•„ë“œì—ì„œ íšŒì› ID ì°¾ê¸°
            const memberId = reservationData.memberId || reservationData.member_id || 
                           document.getElementById('selectedMemberId')?.value;

            console.log('ì°¾ì€ íšŒì› ID:', memberId);

            if (!memberId) {
                alert('íšŒì› ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜ˆì•½ ëª¨ë‹¬ì„ ë‹¤ì‹œ ì—´ì–´ì£¼ì„¸ìš”.');
                return;
            }

            // í˜„ì¬ êµìœ¡ ë©”ëª¨ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const currentMemos = getEducationMemos();
            
            // í˜„ì¬ í•­ëª©ì˜ ì¸ë±ìŠ¤ ì°¾ê¸° (ê¸°ì¡´ í•­ëª©ì¸ì§€ ìƒˆ í•­ëª©ì¸ì§€ í™•ì¸)
            const memoItems = document.querySelectorAll('.education-memo-item');
            const currentIndex = Array.from(memoItems).indexOf(memoItem);
            
            // í˜„ì¬ í•­ëª©ì˜ ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸
            const updatedMemo = {
                date: date,
                content: content
            };

            // ê¸°ì¡´ í•­ëª©ì¸ ê²½ìš° ì—…ë°ì´íŠ¸, ìƒˆ í•­ëª©ì¸ ê²½ìš° ì¶”ê°€
            if (currentIndex < currentMemos.length) {
                currentMemos[currentIndex] = updatedMemo;
            } else {
                currentMemos.push(updatedMemo);
            }

            // ì„œë²„ì— ì €ì¥
            updateMemberEducationMemos(memberId, currentMemos)
                .then(() => {
                    // ì €ì¥ ì„±ê³µ ì‹œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
                    button.style.background = '#059669';
                    button.textContent = 'ì €ì¥ë¨';
                    button.disabled = true;
                    
                    setTimeout(() => {
                        button.style.background = '#10b981';
                        button.textContent = 'ì €ì¥';
                        button.disabled = false;
                    }, 2000);
                })
                .catch(error => {
                    console.error('êµìœ¡ ë©”ëª¨ ì €ì¥ ì‹¤íŒ¨:', error);
                    alert('êµìœ¡ ë©”ëª¨ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        };

        // êµìœ¡ ë©”ëª¨ ë°ì´í„° ìˆ˜ì§‘
        function getEducationMemos() {
            const container = document.getElementById('educationMemosContainer');
            if (!container) return [];

            const memos = [];
            const memoItems = container.querySelectorAll('.education-memo-item');
            
            memoItems.forEach(item => {
                const dateInput = item.querySelector('input[type="date"]');
                const textarea = item.querySelector('textarea');
                
                if (dateInput && textarea && textarea.value.trim()) {
                    memos.push({
                        date: dateInput.value,
                        content: textarea.value.trim()
                    });
                }
            });
            
            return memos;
        }

        // êµìœ¡ ë©”ëª¨ ë°ì´í„° ë¡œë“œ
        function loadEducationMemos(memos) {
            const container = document.getElementById('educationMemosContainer');
            if (!container) return;

            // ê¸°ì¡´ ë©”ëª¨ ì œê±°
            container.innerHTML = '';

            if (memos && memos.length > 0) {
                memos.forEach(memo => {
                    const memoItem = document.createElement('div');
                    memoItem.className = 'education-memo-item';
                    memoItem.style.cssText = `
                        background: white;
                        border: 1px solid #e5e7eb;
                        border-radius: 12px;
                        padding: 16px;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                        transition: all 0.2s ease;
                    `;
                    
                    memoItem.innerHTML = `
                        <div style="display: flex; gap: 12px; align-items: flex-start;">
                            <input type="date" value="${memo.date}" style="flex: 0 0 140px; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; background: #f9fafb; color: #374151; font-weight: 500;">
                            <textarea style="flex: 1; padding: 10px 12px; border: 2px solid #000; border-radius: 8px; font-size: 14px; resize: vertical; min-height: 80px; font-family: inherit; line-height: 1.5; background: white; color: #111827;">${memo.content}</textarea>
                            <div style="display: flex; gap: 8px; flex-direction: column;">
                                <button type="button" onclick="saveEducationMemoItem(this)" style="background: #10b981; color: white; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);" onmouseover="this.style.background='#059669'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.15)'" onmouseout="this.style.background='#10b981'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 2px rgba(0, 0, 0, 0.1)'">ì €ì¥</button>
                                <button type="button" onclick="removeEducationMemoItem(this)" style="background: #ef4444; color: white; border: none; border-radius: 8px; padding: 10px 16px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);" onmouseover="this.style.background='#dc2626'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.15)'" onmouseout="this.style.background='#ef4444'; this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 2px rgba(0, 0, 0, 0.1)'">ì‚­ì œ</button>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(memoItem);
                });
            }
        }

        // êµìœ¡ ë©”ëª¨ ì´ˆê¸°í™”
        function clearEducationMemos() {
            const container = document.getElementById('educationMemosContainer');
            if (!container) return;

            // ê¸°ì¡´ ë©”ëª¨ ì œê±°
            container.innerHTML = '';
        }

        // íšŒì›ì˜ êµìœ¡ ë©”ëª¨ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
        function updateMemberEducationMemos(memberId, educationMemos) {
            console.log('êµìœ¡ ë©”ëª¨ ì €ì¥ ì‹œë„:', {
                memberId: memberId,
                educationMemos: educationMemos,
                educationMemosLength: educationMemos ? educationMemos.length : 0
            });
            
            return fetch('api/update_member_education_memos.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    memberId: memberId,
                    educationMemos: educationMemos
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('êµìœ¡ ë©”ëª¨ ì €ì¥ ì„±ê³µ:', data);
                    return data;
                } else {
                    console.error('êµìœ¡ ë©”ëª¨ ì €ì¥ ì‹¤íŒ¨:', data.message);
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                console.error('êµìœ¡ ë©”ëª¨ ì €ì¥ ì¤‘ ì˜¤ë¥˜:', error);
                throw error;
            });
        }

        // ìƒˆë¡œìš´ ì˜ˆì•½ ì‹œìŠ¤í…œ ë³€ìˆ˜
        const timeSlots = [
            '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00',
            '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30',
            '16:00', '16:30', '17:00', '17:30', '18:00', '18:30', '19:00',
            '19:30', '20:00', '20:30', '21:00', '21:30', '22:00', '22:30',
            '23:00', '23:30', '24:00', 'NULL'
        ];
        
        let dragState = {
            isActive: false,
            startTime: null,
            startSlot: null,
            endTime: null,
            startDay: null
        };
        
        // ì˜ˆì•½ ë¸”ë¡ ìƒì„±ì„ ìœ„í•œ ì˜êµ¬ ì €ì¥ ë³€ìˆ˜
        let reservationInfo = {
            day: null,
            seat: null
        };
        
        let currentReservationData = null; // í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ ì˜ˆì•½ ë°ì´í„°
        
        // ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì • í•¨ìˆ˜
        function determineColorClass(scheduleType, productName, productHours) {
            console.log('ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •:', {
                scheduleType,
                productName,
                productHours,
                productHoursType: typeof productHours
            });
            
            // ê²°ì„ ì²˜ë¦¬ì¸ ê²½ìš° ë¹¨ê°„ìƒ‰
            if (scheduleType === 'absent') {
                console.log('ê²°ì„ ìƒ‰ìƒ ë°˜í™˜');
                return 'absent';
            }
            // ìƒí’ˆì´ ì—†ëŠ” ê²½ìš° (ë¹„íšŒì›)
            else if (scheduleType === 'no-product' || !productName || productName.trim() === '') {
                console.log('ë¹„íšŒì› ìƒ‰ìƒ ë°˜í™˜');
                return 'none';
            }
            // ìƒí’ˆì´ ìˆëŠ” ê²½ìš° product_hoursë¡œ ìƒ‰ìƒ ê²°ì •
            else if (productHours !== undefined && productHours !== null) {
                const hours = Number(productHours);
                console.log('productHoursë¡œ ìƒ‰ìƒ ê²°ì •:', hours);
                
                // productHoursê°€ 0ì´ì§€ë§Œ ìƒí’ˆëª…ì— ì‹œê°„ ì •ë³´ê°€ ìˆìœ¼ë©´ ì‹œê°„ì œë¡œ ì²˜ë¦¬
                if (hours === 0 && productName && (productName.includes('ì‹œê°„') || productName.includes('hour'))) {
                    console.log('ìƒí’ˆëª…ì— ì‹œê°„ ì •ë³´ê°€ ìˆì–´ì„œ ì‹œê°„ì œ ìƒ‰ìƒ ë°˜í™˜');
                    return 'time'; // ë³´ë¼ìƒ‰ - ì‹œê°„ì œ
                }
                else if (hours === 0) {
                    console.log('ë¬´ì œí•œ ìƒ‰ìƒ ë°˜í™˜');
                    return 'unlimited'; // ë…¹ìƒ‰ - ë¬´ì œí•œ
                } else if (hours > 0) {
                    console.log('ì‹œê°„ì œ ìƒ‰ìƒ ë°˜í™˜');
                    return 'time'; // ë³´ë¼ìƒ‰ - ì‹œê°„ì œ
                }
            }
            // product_hoursê°€ ì—†ëŠ” ê²½ìš° ìƒí’ˆëª…ìœ¼ë¡œ íŒë‹¨
            else if (productName) {
                const product = productName.toLowerCase();
                console.log('ìƒí’ˆëª…ìœ¼ë¡œ ìƒ‰ìƒ íŒë‹¨:', product);
                
                if (product.includes('ë¬´ì œí•œ') || product.includes('unlimited')) {
                    console.log('ìƒí’ˆëª…ìœ¼ë¡œ ë¬´ì œí•œ ìƒ‰ìƒ ë°˜í™˜');
                    return 'unlimited';
                } else if (product.includes('ì‹œê°„') || product.includes('hour') || product.includes('ì‹œê°„í˜•')) {
                    console.log('ìƒí’ˆëª…ìœ¼ë¡œ ì‹œê°„ì œ ìƒ‰ìƒ ë°˜í™˜');
                    return 'time';
                }
            }
            
            console.log('ê¸°ë³¸ ìƒ‰ìƒ ë°˜í™˜');
            return 'custom'; // ê¸°ë³¸ ìƒ‰ìƒ
        }
        
        // ëª¨ë“  ì˜ˆì•½ ë¸”ë¡ì˜ ìƒ‰ìƒì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateAllReservationBlockColors() {
            const reservationBlocks = document.querySelectorAll('.reservation-block');
            
            reservationBlocks.forEach((block, index) => {
                const reservationId = block.getAttribute('data-reservation-id');
                if (reservationId) {
                    // ì„œë²„ì—ì„œ ì˜ˆì•½ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                    fetch(`api/get_reservations.php`)
                        .then(response => response.json())
                        .then(result => {
                            if (result.success) {
                                const reservation = result.reservations.find(r => r.id == reservationId);
                                if (reservation) {
                                    const newColorClass = determineColorClass(
                                        reservation.scheduleType,
                                        reservation.productName || reservation.product_name,
                                        reservation.product_hours
                                    );
                                    
                                    // ê¸°ì¡´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì œê±°
                                    block.classList.remove('custom', 'time', 'none', 'unlimited', 'course', 'absent');
                                    // ìƒˆë¡œìš´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì¶”ê°€
                                    block.classList.add(newColorClass);
                                    block.className = `reservation-block ${newColorClass}`;
                                    
                                    // ì¸ë¼ì¸ background ìŠ¤íƒ€ì¼ ì œê±° (CSS í´ë˜ìŠ¤ê°€ ìš°ì„ ë˜ë„ë¡)
                                    block.style.removeProperty('background');
                                    block.style.removeProperty('background-color');
                                    
                                }
                            }
                        })
                        .catch(error => {
                            console.error('ì˜ˆì•½ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                        });
                }
            });
        }

        // ìƒˆë¡œìš´ ìº˜ë¦°ë” ì´ˆê¸°í™” í•¨ìˆ˜
        function initializeCalendar() {
            console.log('ìº˜ë¦°ë” ì´ˆê¸°í™” ì‹œì‘');
            
            const calendarBody = document.getElementById('calendarBody');
            calendarBody.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì‚­ì œ
            
            // 4ìë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ ìº˜ë¦°ë” ìƒì„±
            timeSlots.forEach((time, timeIndex) => {
                // ì‹œê°„ ìŠ¬ë¡¯
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                timeSlot.textContent = time;
                calendarBody.appendChild(timeSlot);

                // ê° ìš”ì¼ë³„ 4ìë¦¬ ì‹œìŠ¤í…œ
                for (let day = 1; day <= 7; day++) {
                    // ìš”ì¼ ì»¬ëŸ¼ ì»¨í…Œì´ë„ˆ
                    const dayColumn = document.createElement('div');
                    dayColumn.className = 'day-column';
                    dayColumn.setAttribute('data-day', day);
                    
                    // 6ê°œ ì¢Œì„ ìƒì„±
                    for (let seat = 1; seat <= 6; seat++) {
                        const slot = document.createElement('div');
                        slot.className = 'reservation-slot';
                        slot.setAttribute('data-time-index', timeIndex);
                        slot.setAttribute('data-day', day);
                        slot.setAttribute('data-seat', seat);
                        
                        // ì˜¤ëŠ˜ ë‚ ì§œì¸ì§€ í™•ì¸í•˜ì—¬ today í´ë˜ìŠ¤ ì¶”ê°€ (10/1 ìˆ˜ìš”ì¼ = data-day="3")
                        const today = new Date();
                        const currentDay = today.getDay(); // 0=ì¼ìš”ì¼, 1=ì›”ìš”ì¼, ..., 6=í† ìš”ì¼
                        
                        // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ì£¼ê°€ ì˜¤ëŠ˜ì˜ ì£¼ì¸ì§€ í™•ì¸
                        const monday = new Date(today);
                        monday.setDate(today.getDate() - currentDay + 1);
                        monday.setHours(0, 0, 0, 0);
                        
                        const isCurrentWeek = currentWeekStart && 
                            currentWeekStart.getTime() === monday.getTime();
                        
                        // ì˜¤ëŠ˜ ë‚ ì§œì¸ì§€ í™•ì¸ (ìˆ˜ìš”ì¼ = day 3)
                        const isToday = isCurrentWeek && (day === 3);
                        
                        if (isToday) {
                            slot.classList.add('today');
                            console.log('ìˆ˜ìš”ì¼(10/1) ì…€ì— today í´ë˜ìŠ¤ ì¶”ê°€');
                        }
                        
                        dayColumn.appendChild(slot);
                    }
                    
                    calendarBody.appendChild(dayColumn);
                }
            });
            
            // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            initializeDragEvents();
            
            
            // í—¤ë”ì™€ ë³¸ë¬¸ ìŠ¤í¬ë¡¤ ë™ê¸°í™”
            initializeScrollSync();
            
            // ëª¨ë‹¬ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            initializeModalEvents();
            
            // ì°¨ê° ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì„ì‹œ ë¹„í™œì„±í™”)
            // loadDeductedBlocks();
            
            // ìº˜ë¦°ë” ì´ˆê¸°í™” ì™„ë£Œ í›„ ì˜ˆì•½ ë°ì´í„° ë¡œë“œ
            console.log('ìº˜ë¦°ë” ì´ˆê¸°í™” ì™„ë£Œ, ì˜ˆì•½ ë°ì´í„° ë¡œë“œ ì‹œì‘');
            loadReservationsOnPageLoad();
        }
        
        // í—¤ë”ì™€ ë³¸ë¬¸ ìŠ¤í¬ë¡¤ ë™ê¸°í™” í•¨ìˆ˜
        function initializeScrollSync() {
            const calendarWrapper = document.querySelector('.calendar-wrapper');
            const calendarHeader = document.querySelector('.calendar-header');
            const calendarBody = document.getElementById('calendarBody');
            
            if (calendarWrapper && calendarHeader && calendarBody) {
                // ë˜í¼ ìŠ¤í¬ë¡¤ ì‹œ í—¤ë”ì™€ ë³¸ë¬¸ì´ í•¨ê»˜ ì›€ì§ì„ (ìë™)
                console.log('ìŠ¤í¬ë¡¤ ë™ê¸°í™” ì„¤ì • ì™„ë£Œ - ë˜í¼ ë°©ì‹');
            }
        }
        
        // ëª¨ë‹¬ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
        function initializeModalEvents() {
            const modal = document.getElementById('reservationModal');
            if (!modal) {
                console.error('reservationModalì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return;
            }
            
            const closeBtn = modal.querySelector('.modal__close');
            const cancelBtn = modal.querySelector('.btn--cancel');
            
            if (closeBtn) closeBtn.addEventListener('click', closeModal);
            if (cancelBtn) cancelBtn.addEventListener('click', closeModal);
            
            // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            initializeEditModalEvents();
        }
        
        // ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
        function initializeEditModalEvents() {
            // ì´ í•¨ìˆ˜ëŠ” ì´ì œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ - setupEditModeButtonsë¡œ ëŒ€ì²´
        }
        
        // ìˆ˜ì • ëª¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEditModeButtons() {
            const deleteBtn = document.getElementById('deleteReservationBtn');
            const absentBtn = document.getElementById('markAbsentBtn');
            const updateBtn = document.getElementById('updateReservationBtn');
            
            console.log('ìˆ˜ì • ëª¨ë“œ ë²„íŠ¼ ì„¤ì •:', { deleteBtn, absentBtn, updateBtn });
            
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
            if (deleteBtn) {
                deleteBtn.removeEventListener('click', deleteReservation);
                deleteBtn.addEventListener('click', deleteReservation);
            }
            if (absentBtn) {
                absentBtn.removeEventListener('click', markAbsent);
                absentBtn.addEventListener('click', markAbsent);
            }
            if (updateBtn) {
                updateBtn.removeEventListener('click', updateReservation);
                updateBtn.addEventListener('click', updateReservation);
            }
        }
        
        // ê²°ì„ ì²˜ë¦¬ í•¨ìˆ˜
        function markAbsent() {
            console.log('ê²°ì„ ì²˜ë¦¬ ì‹œì‘');
            
            if (!currentReservationData) {
                alert('ì˜ˆì•½ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ì´ ì˜ˆì•½ì„ ê²°ì„ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì˜ˆì•½ ë¸”ë¡ì„ ê²°ì„ ì²˜ë¦¬ë¡œ ë³€ê²½
                const reservationId = currentReservationData.id;
                
                // ì„œë²„ì—ì„œ ì˜ˆì•½ì„ ê²°ì„ ì²˜ë¦¬ë¡œ ì—…ë°ì´íŠ¸
                updateReservationOnServer(reservationId, {
                    ...currentReservationData,
                    scheduleType: 'absent'
                }).then(() => {
                    // ì˜ˆì•½ ë¸”ë¡ì˜ ìƒ‰ìƒì„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë³€ê²½
                    const reservationBlock = document.querySelector(`[data-reservation-id="${reservationId}"]`);
                    if (reservationBlock) {
                        // ê¸°ì¡´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì œê±°
                        reservationBlock.classList.remove('custom', 'time', 'none', 'unlimited', 'course');
                        // ê²°ì„ ìƒ‰ìƒ í´ë˜ìŠ¤ ì¶”ê°€
                        reservationBlock.classList.add('absent');
                        reservationBlock.className = 'reservation-block absent';
                        
                        console.log('ì˜ˆì•½ ë¸”ë¡ì´ ê²°ì„ ì²˜ë¦¬ë¡œ ë³€ê²½ë¨');
                    }
                    
                    alert('ê²°ì„ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeModal();
                }).catch(error => {
                    console.error('ê²°ì„ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    alert('ê²°ì„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
            }
        }
        
        // ìƒˆë¡œìš´ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
        function initializeDragEvents() {
            const calendarBody = document.getElementById('calendarBody');
            
            // ì „ì—­ ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ (ë§ˆìš°ìŠ¤ê°€ ìº˜ë¦°ë” ë°–ìœ¼ë¡œ ë‚˜ê°”ì„ ë•Œ)
            document.addEventListener('mouseup', function(e) {
                if (dragState.startTime !== null) {
                    finishDrag();
                }
            });
            
            // ESC í‚¤ë¡œ ë“œë˜ê·¸ ì·¨ì†Œ
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && dragState.startTime !== null) {
                    resetDragState();
                }
            });
            
            // ë§ˆìš°ìŠ¤ ë‹¤ìš´ ì´ë²¤íŠ¸
            calendarBody.addEventListener('mousedown', function(e) {
                if (e.button !== 0) return; // ì¢Œí´ë¦­ë§Œ
                
                const slot = findSlotAtPosition(e.clientX, e.clientY);
                if (!slot) return;
                
                e.preventDefault();
                e.stopPropagation();
                
                // ê¸°ì¡´ ë“œë˜ê·¸ ìƒíƒœ ì´ˆê¸°í™”
                resetDragState();
                
                // ì‹œì‘ ì •ë³´ ì €ì¥
                const timeInfo = getTimeFromSlot(slot);
                dragState.startTime = timeInfo.timeIndex;
                dragState.startSlot = slot;
                dragState.startDay = timeInfo.day;
                dragState.isActive = false;
                
                // ì˜ˆì•½ ì •ë³´ ì˜êµ¬ ì €ì¥
                reservationInfo.day = timeInfo.day;
                reservationInfo.seat = parseInt(slot.getAttribute('data-seat'));
                
                
                // ìš”ì¼ í™•ì¸
                const dayNames = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
                
                // reservationInfoê°€ ì œëŒ€ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (!reservationInfo.day || !reservationInfo.seat) {
                    reservationInfo.day = parseInt(slot.getAttribute('data-day'));
                    reservationInfo.seat = parseInt(slot.getAttribute('data-seat'));
                }
                
                const seat = parseInt(slot.getAttribute('data-seat'));
            });
            
            // ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸
            calendarBody.addEventListener('mousemove', function(e) {
                // ë§ˆìš°ìŠ¤ ë²„íŠ¼ì´ ëˆŒë ¤ìˆì§€ ì•Šìœ¼ë©´ ë“œë˜ê·¸ ì¢…ë£Œ
                if (e.buttons !== 1) {
                    if (dragState.isActive || dragState.startTime !== null) {
                        finishDrag();
                    }
                    return;
                }
                
                // ë“œë˜ê·¸ ì‹œì‘ (ë§ˆìš°ìŠ¤ê°€ ì›€ì§ì´ê¸° ì‹œì‘í•  ë•Œ)
                if (dragState.startTime !== null && !dragState.isActive) {
                    console.log('ë“œë˜ê·¸ ì‹œì‘ íŠ¸ë¦¬ê±°');
                    startDrag();
                }
                
                // ë“œë˜ê·¸ ì¤‘ì´ ì•„ë‹ˆë©´ ë¦¬í„´
                if (!dragState.isActive) return;
                
                
                // í˜„ì¬ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì˜ ì‹œê°„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const timeInfo = getTimeFromPosition(e.clientX, e.clientY);
                if (!timeInfo) {
                    console.log('ì‹œê°„ ì •ë³´ ì—†ìŒ');
                    return;
                }
                
                // ì‹œì‘ ì‹œê°„ë³´ë‹¤ ì´í›„ ì‹œê°„ë§Œ ì„ íƒ ê°€ëŠ¥
                if (timeInfo.timeIndex <= dragState.startTime) {
                    console.log('ì‹œì‘ ì‹œê°„ë³´ë‹¤ ì´ì „:', timeInfo.timeIndex, '<=', dragState.startTime);
                    return;
                }
                
                // ê°™ì€ ì¢Œì„ ì—´ì—ì„œë§Œ ë“œë˜ê·¸ ê°€ëŠ¥
                const currentSlot = findSlotAtPosition(e.clientX, e.clientY);
                if (!currentSlot) {
                    console.log('í˜„ì¬ ìŠ¬ë¡¯ ì—†ìŒ');
                    return;
                }
                
                if (!isSameSeatColumn(dragState.startSlot, currentSlot)) {
                    console.log('ë‹¤ë¥¸ ì¢Œì„ ì—´');
                    return;
                }
                
                // ì¢…ë£Œ ì‹œê°„ ì—…ë°ì´íŠ¸
                dragState.endTime = timeInfo.timeIndex;
                updateDragVisual();
            });
        }
        
        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function findSlotAtPosition(x, y) {
            const allSlots = document.querySelectorAll('.reservation-slot');
            for (let slot of allSlots) {
                const rect = slot.getBoundingClientRect();
                if (x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom) {
                    return slot;
                }
            }
            return null;
        }
        
        // íŠ¹ì • ì¢Œì„ì˜ ì„¸ë¡œ ì—´ ì°¾ê¸° (ê°™ì€ ìš”ì¼, ê°™ì€ ì¢Œì„ ë²ˆí˜¸)
        function findSeatColumn(startSlot) {
            const startDay = parseInt(startSlot.getAttribute('data-day'));
            const startSeat = parseInt(startSlot.getAttribute('data-seat'));
            
            const allSlots = document.querySelectorAll('.reservation-slot');
            const seatColumn = [];
            
            allSlots.forEach(slot => {
                const day = parseInt(slot.getAttribute('data-day'));
                const seat = parseInt(slot.getAttribute('data-seat'));
                
                if (day === startDay && seat === startSeat) {
                    seatColumn.push(slot);
                }
            });
            
            return seatColumn.sort((a, b) => {
                const timeA = parseInt(a.getAttribute('data-time-index'));
                const timeB = parseInt(b.getAttribute('data-time-index'));
                return timeA - timeB;
            });
        }
        
        // ê°™ì€ ì¢Œì„ ì—´ì¸ì§€ í™•ì¸
        function isSameSeatColumn(slot1, slot2) {
            const day1 = parseInt(slot1.getAttribute('data-day'));
            const seat1 = parseInt(slot1.getAttribute('data-seat'));
            const day2 = parseInt(slot2.getAttribute('data-day'));
            const seat2 = parseInt(slot2.getAttribute('data-seat'));
            
            return day1 === day2 && seat1 === seat2;
        }
        
        function getTimeFromSlot(slot) {
            const timeIndex = parseInt(slot.getAttribute('data-time-index'));
            const day = parseInt(slot.getAttribute('data-day'));
            
            
            return {
                timeIndex: timeIndex,
                timeText: timeSlots[timeIndex] || 'unknown',
                day: day
            };
        }
        
        function getTimeFromPosition(x, y) {
            const slot = findSlotAtPosition(x, y);
            return slot ? getTimeFromSlot(slot) : null;
        }
        
        function startDrag() {
            dragState.isActive = true;
            console.log('ë“œë˜ê·¸ ì‹œì‘');
            
            // ì‹œê°„ í‘œì‹œê¸° ìƒì„±
            createTimeIndicator();
        }
        
        function updateDragVisual() {
            if (dragState.endTime && dragState.endTime > dragState.startTime) {
                console.log('ë“œë˜ê·¸ ì¤‘:', dragState.startTime, '~', dragState.endTime);
                
                // ì‹œê°„ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
                updateTimeIndicator();
                
                // ì„ì‹œ ì˜ˆì•½ ë¸”ë¡ í‘œì‹œ (ê°™ì€ ì¢Œì„ ì—´ì—ì„œë§Œ)
                updateTempReservation(dragState.startTime, dragState.endTime);
            }
        }
        
        function finishDrag() {
            console.log('ë“œë˜ê·¸ ì¢…ë£Œ');
            console.log('ë“œë˜ê·¸ ìƒíƒœ:', dragState);
            
            if (dragState.startTime !== null) {
                // reservationInfo ì—…ë°ì´íŠ¸ (ë“œë˜ê·¸ ì¢…ë£Œ ì‹œì ì—ì„œ)
                if (dragState.startSlot) {
                    const timeInfo = getTimeFromSlot(dragState.startSlot);
                    reservationInfo.day = timeInfo.day;
                    reservationInfo.seat = parseInt(dragState.startSlot.getAttribute('data-seat'));
                    console.log('ğŸ”§ finishDragì—ì„œ reservationInfo ì—…ë°ì´íŠ¸:', reservationInfo);
                }
                
                if (dragState.isActive && dragState.endTime && dragState.endTime > dragState.startTime) {
                    // ì‹¤ì œ ë“œë˜ê·¸: ì„ íƒí•œ ì‹œê°„ëŒ€ë¡œ ì˜ˆì•½
                    console.log('ë“œë˜ê·¸ ì˜ˆì•½:', dragState.startTime, '~', dragState.endTime, 'ìš”ì¼:', dragState.startDay);
                    openReservationModal(dragState.startTime, dragState.endTime, dragState.startDay);
                } else {
                    // ë‹¨ì¼ í´ë¦­: 30ë¶„ ì˜ˆì•½
                    console.log('ë‹¨ì¼ í´ë¦­ 30ë¶„ ì˜ˆì•½:', dragState.startTime, 'ìš”ì¼:', dragState.startDay);
                    openReservationModal(dragState.startTime, dragState.startTime + 1, dragState.startDay);
                }
            }
            
            resetDragState();
        }
        
        function resetDragState() {
            dragState.isActive = false;
            dragState.startTime = null;
            dragState.startSlot = null;
            dragState.endTime = null;
            dragState.startDay = null;
            
            // ì‹œê°ì  ìš”ì†Œë“¤ ì •ë¦¬
            cleanupDrag();
        }
        
        // ê°„ë‹¨í•œ ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function openReservationModal(startTime, endTime, targetDay = null) {
            console.log('ëª¨ë‹¬ ì—´ê¸°:', startTime, endTime, 'ìš”ì¼:', targetDay);
            const modal = document.getElementById('reservationModal');
            
            // ë“œë˜ê·¸í•œ ì‹œê°„ì„ ì‹œì‘ì‹œê°„ê³¼ ì¢…ë£Œì‹œê°„ì— ìë™ ì„¤ì •
            let startHour = Math.floor(startTime * 0.5) + 9;
            let startMinute = (startTime * 0.5) % 1 === 0 ? '00' : '30';
            
            // 24ì‹œ í‘œì‹œ ì²˜ë¦¬ (ì‹œì‘ì‹œê°„)
            if (startHour >= 24) {
                startHour = 24;
                startMinute = '00';
            }
            
            // ë‹¨ì¼ í´ë¦­(30ë¶„ ì˜ˆì•½)ê³¼ ë“œë˜ê·¸ êµ¬ë¶„
            let endHour, endMinute;
            if (endTime === startTime + 1) {
                // ë‹¨ì¼ í´ë¦­: 30ë¶„ ì˜ˆì•½ (30ë¶„ ë¹¼ì§€ ì•ŠìŒ)
                endHour = Math.floor(endTime * 0.5) + 9;
                endMinute = (endTime * 0.5) % 1 === 0 ? '00' : '30';
            } else {
                // ë“œë˜ê·¸: ì„ íƒí•œ ì‹œê°„ëŒ€ë¡œ ì˜ˆì•½ (30ë¶„ ë¹¼ê¸°)
                endHour = Math.floor((endTime - 1) * 0.5) + 9;
                endMinute = ((endTime - 1) * 0.5) % 1 === 0 ? '00' : '30';
            }
            
            // 24ì‹œ í‘œì‹œ ì²˜ë¦¬ (24:00ì´ 00:00ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ë¬¸ì œ í•´ê²°)
            if (endHour >= 24) {
                endHour = 24;
                endMinute = '00';
            }
            
            console.log('ì‹œê°„ ë³€í™˜:', {
                startTime: startTime,
                endTime: endTime,
                startHour: startHour,
                startMinute: startMinute,
                endHour: endHour,
                endMinute: endMinute
            });
            
            // ì‹œì‘ì‹œê°„ ì„¤ì •
            const startHourSelect = document.getElementById('startHour');
            const startMinuteSelect = document.getElementById('startMinute');
            if (startHourSelect && startMinuteSelect) {
                startHourSelect.value = startHour.toString().padStart(2, '0');
                startMinuteSelect.value = startMinute;
                console.log('ì‹œì‘ì‹œê°„ ì„¤ì •:', startHour + ':' + startMinute);
            }
            
            // ì¢…ë£Œì‹œê°„ ì„¤ì • (30ë¶„ ì¶”ê°€)
            const endHourSelect = document.getElementById('endHour');
            const endMinuteSelect = document.getElementById('endMinute');
            if (endHourSelect && endMinuteSelect) {
                // 30ë¶„ ì¶”ê°€
                let displayEndHour = endHour;
                let displayEndMinute = endMinute;
                
                if (endMinute === '30') {
                    displayEndHour = endHour + 1;
                    displayEndMinute = '00';
                } else {
                    displayEndMinute = '30';
                }
                
                // 24ì‹œ ë„˜ì–´ê°€ë©´ 24ì‹œë¡œ ì œí•œ
                if (displayEndHour >= 24) {
                    displayEndHour = 23;
                    displayEndMinute = '30';
                }
                
                endHourSelect.value = displayEndHour.toString().padStart(2, '0');
                endMinuteSelect.value = displayEndMinute;
                console.log('ì¢…ë£Œì‹œê°„ ì„¤ì • (30ë¶„ ì¶”ê°€):', displayEndHour + ':' + displayEndMinute);
            }
            
            // ì˜ˆì•½ì¼ ì„¤ì • (í´ë¦­í•œ ì…€ì˜ ì‹¤ì œ ë‚ ì§œ)
            const reservationDateInput = document.getElementById('reservationDate');
            if (reservationDateInput && targetDay) {
                // targetDayê°€ ì£¼ì–´ì¡Œìœ¼ë©´ í•´ë‹¹ ìš”ì¼ì˜ ë‚ ì§œ ê³„ì‚°
                const currentWeek = getCurrentWeek();
                const targetDate = new Date(currentWeek[targetDay - 1]);
                reservationDateInput.value = targetDate.toISOString().split('T')[0];
                console.log('ì˜ˆì•½ì¼ ì„¤ì •:', targetDate.toISOString().split('T')[0], 'ìš”ì¼:', targetDay);
            } else if (reservationDateInput) {
                // targetDayê°€ ì—†ìœ¼ë©´ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •
                const today = new Date();
                reservationDateInput.value = today.toISOString().split('T')[0];
                console.log('ì˜ˆì•½ì¼ ì„¤ì • (ì˜¤ëŠ˜):', today.toISOString().split('T')[0]);
            }
            
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            // íšŒì› ì„ íƒ ì´ë²¤íŠ¸ ì„¤ì •
            setupMemberSelectEvent();
            
            // êµìœ¡ ë©”ëª¨ ê¸°ëŠ¥ ì´ˆê¸°í™”
            setupEducationMemoFeature();
            
            // ì‹œí—˜ ì¼ì • í•„ë“œ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            setupTestScheduleFields();
            
            // ê³„ì† ì˜ˆì•½ì„ ìœ„í•œ íšŒì› ì •ë³´ê°€ ìˆìœ¼ë©´ ë¯¸ë¦¬ ì…ë ¥
            if (lastReservationMember) {
                console.log('ê³„ì† ì˜ˆì•½ì„ ìœ„í•œ íšŒì› ì •ë³´ ë¡œë“œ:', lastReservationMember);
                
                // íšŒì› ì´ë¦„ ì…ë ¥
                const memberSearchInput = document.getElementById('memberSearchInput');
                const selectedMemberId = document.getElementById('selectedMemberId');
                if (memberSearchInput) {
                    memberSearchInput.value = lastReservationMember.memberName;
                }
                if (selectedMemberId) {
                    selectedMemberId.value = lastReservationMember.memberId;
                }
                
                // íšŒì› íƒ€ì… ì„¤ì •
                const memberTypeRadio = document.querySelector(`input[name="memberType"][value="${lastReservationMember.memberType}"]`);
                if (memberTypeRadio) {
                    memberTypeRadio.checked = true;
                    handleMemberTypeChange(lastReservationMember.memberType, true); // preserveValues = true
                }
                
                // ì¼ì • ìœ í˜• ì„¤ì •
                const scheduleTypeRadio = document.querySelector(`input[name="scheduleType"][value="${lastReservationMember.scheduleType}"]`);
                if (scheduleTypeRadio) {
                    scheduleTypeRadio.checked = true;
                }
                
                // ì—°ë½ì²˜ ì…ë ¥
                const contactInput = document.getElementById('contactInput');
                if (contactInput) {
                    contactInput.value = lastReservationMember.contactPhone;
                }
                
                // íšŒì› ìƒì„¸ ì •ë³´ ë¡œë“œ (êµìœ¡ ë©”ëª¨ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìë™ìœ¼ë¡œ ë¡œë“œë¨)
                if (lastReservationMember.memberId && lastReservationMember.memberType === 'existing') {
                    loadMemberDetail(lastReservationMember.memberId);
                }
            }
            
            // ë²„íŠ¼ ë§ˆì§„ ì ìš© (ê°•ì œ)
            setTimeout(() => {
                const normalModeButtons = document.getElementById('normalModeButtons');
                const editModeButtons = document.getElementById('editModeButtons');
                const buttonContainer = document.querySelector('div[style*="display: flex"][style*="gap: 15px"][style*="justify-content: flex-end"]');
                
                if (normalModeButtons) {
                    normalModeButtons.style.margin = '0 20px !important';
                }
                if (editModeButtons) {
                    editModeButtons.style.margin = '0 20px !important';
                }
                if (buttonContainer) {
                    buttonContainer.style.marginLeft = '20px';
                    buttonContainer.style.marginRight = '20px';
                }
            }, 100);
            
            // currentReservationData ì„¤ì • (actualDate í¬í•¨)
            const currentWeek = getCurrentWeek();
            let actualDate = null;
            
            if (targetDay && targetDay >= 1 && targetDay <= 7) {
                const dateObj = currentWeek[targetDay - 1];
                console.log('dateObj:', dateObj);
                console.log('dateObj íƒ€ì…:', typeof dateObj);
                
                if (dateObj instanceof Date) {
                    // Date ê°ì²´ë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                    actualDate = dateObj.toISOString().split('T')[0];
                    console.log('ë³€í™˜ëœ actualDate:', actualDate);
                } else {
                    console.error('dateObjê°€ Date ê°ì²´ê°€ ì•„ë‹™ë‹ˆë‹¤:', dateObj);
                }
            } else {
                console.log('targetDayê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:', targetDay);
            }
            
            currentReservationData = {
                actualDate: actualDate,
                targetDay: targetDay,
                startTime: startTime,
                endTime: endTime
            };
            
            console.log('currentReservationData ì„¤ì •:', currentReservationData);
            console.log('ëª¨ë‹¬ í‘œì‹œë¨');
        }
        
        function closeModal() {
            const modal = document.getElementById('reservationModal');
            modal.style.display = 'none';
            
            // í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ ì˜ˆì•½ ë°ì´í„° ì´ˆê¸°í™”
            currentReservationData = null;
            
            // ì¼ë°˜ ëª¨ë“œë¡œ ë˜ëŒë¦¬ê¸°
            document.getElementById('editModeButtons').style.display = 'none';
            const normalModeButtons = document.getElementById('normalModeButtons');
            normalModeButtons.style.display = 'flex';
            normalModeButtons.style.margin = '0 20px';
            
            // í¼ ì´ˆê¸°í™”
            const memberSearchInput = document.getElementById('memberSearchInput');
            const selectedMemberId = document.getElementById('selectedMemberId');
            if (memberSearchInput) memberSearchInput.value = '';
            if (selectedMemberId) selectedMemberId.value = '';
            document.getElementById('contactInput').value = '';
            document.getElementById('productInput').value = '';
            document.getElementById('reservationMemo').value = '';
            
            // êµìœ¡ ë° ë©”ëª¨ì‚¬í•­ ì´ˆê¸°í™”
            clearEducationMemos();
            
            // ì‹œí—˜ ì¼ì • ì´ˆê¸°í™”
            document.getElementById('functionTestDate').value = '';
            document.getElementById('roadTestDate').value = '';
            
            // íšŒì› ìƒì„¸ ì •ë³´ ìˆ¨ê¸°ê¸°
            hideMemberDetail();
            
            console.log('ëª¨ë‹¬ ë‹«í˜');
        }
        
        // ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ (ê¸°ì¡´ ëª¨ë‹¬ ì¬ì‚¬ìš©)
        function openReservationEditModal(reservationData) {
            console.log('ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°:', reservationData);
            
            // actualDateê°€ ì—†ìœ¼ë©´ targetDayë¡œ ê³„ì‚°
            if (!reservationData.actualDate && reservationData.targetDay !== undefined) {
                const currentWeek = getCurrentWeek();
                const calculatedDate = new Date(currentWeek[reservationData.targetDay]);
                reservationData.actualDate = calculatedDate.toISOString().split('T')[0];
                console.log('ğŸ”§ actualDate ê³„ì‚°ë¨:', {
                    targetDay: reservationData.targetDay,
                    calculatedDate: reservationData.actualDate,
                    ìš”ì¼: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'][reservationData.targetDay]
                });
            }
            
            // í˜„ì¬ ìˆ˜ì • ì¤‘ì¸ ì˜ˆì•½ ë°ì´í„° ì €ì¥
            currentReservationData = reservationData;
            
            // actualDateë¥¼ currentReservationDataì— ëª…ì‹œì ìœ¼ë¡œ ì €ì¥
            if (reservationData.actualDate) {
                currentReservationData.actualDate = reservationData.actualDate;
            }
            
            // actualDateê°€ ìˆìœ¼ë©´ ë¡œê·¸ ì¶œë ¥
            if (reservationData.actualDate) {
            } else {
            }
            
            const modal = document.getElementById('reservationModal');
            
            // í¼ ë°ì´í„° ì±„ìš°ê¸°
            const memberSearchInput = document.getElementById('memberSearchInput');
            const selectedMemberId = document.getElementById('selectedMemberId');
            
            // ë¹„íšŒì›ì¸ì§€ í™•ì¸ (scheduleTypeì´ 'no-product'ì´ê±°ë‚˜ memberTypeì´ 'quick'ì´ê±°ë‚˜ memberIdê°€ ì—†ëŠ” ê²½ìš°)
            const isNonMember = reservationData.scheduleType === 'no-product' || reservationData.memberType === 'quick' || !reservationData.memberId;
            
            if (!isNonMember && reservationData.memberId) {
                // íšŒì› IDë¡œ íšŒì› ì •ë³´ ì°¾ê¸°
                const member = allMembers.find(m => m.id == reservationData.memberId);
                if (member) {
                    memberSearchInput.value = member.name;
                    selectedMemberId.value = member.id;
                    // ì—°ë½ì²˜ ìë™ ì…ë ¥
                    const contactInput = document.getElementById('contactInput');
                    if (contactInput) {
                        contactInput.value = member.phone || '';
                    }
                } else {
                    memberSearchInput.value = '';
                    selectedMemberId.value = '';
                }
            } else {
                // ë¹„íšŒì›ì¸ ê²½ìš°
                
                memberSearchInput.value = reservationData.memberName || '';
                selectedMemberId.value = '';
                
                // ì—°ë½ì²˜ í•„ë“œì— ì €ì¥ëœ ì—°ë½ì²˜ ì •ë³´ í‘œì‹œ
                const contactInput = document.getElementById('contactInput');
                if (contactInput) {
                    contactInput.value = reservationData.contactPhone || '';
                }
                
            }
            // íšŒì› ìœ í˜• ì„¤ì • (í•„ë“œ ê°’ ì„¤ì • í›„ì— í˜¸ì¶œ)
            let memberType = reservationData.memberType;
            if (isNonMember) {
                memberType = 'quick'; // ë¹„íšŒì›ì¸ ê²½ìš° ê°•ì œë¡œ 'quick' ì„¤ì •
            }
            
            const memberTypeRadio = document.querySelector(`input[name="memberType"][value="${memberType}"]`);
            if (memberTypeRadio) {
                memberTypeRadio.checked = true;
                
                // ë¹„íšŒì›ì¸ ê²½ìš°ì—ë§Œ í”Œë ˆì´ìŠ¤í™€ë” ì„¤ì •
                if (isNonMember) {
                    const searchInput = document.getElementById('memberSearchInput');
                    if (searchInput) {
                        searchInput.placeholder = 'íšŒì› ì´ë¦„ì„ ì‘ì„±í•´ì£¼ì„¸ìš”';
                    }
                }
            }
            document.getElementById('startHour').value = reservationData.startHour;
            document.getElementById('startMinute').value = reservationData.startMinute;
            document.getElementById('endHour').value = reservationData.endHour;
            document.getElementById('endMinute').value = reservationData.endMinute;
            // ì¼ì • ìœ í˜• ì„¤ì •
            let scheduleTypeValue = reservationData.scheduleType;
            if (scheduleTypeValue === 'no-product') {
                scheduleTypeValue = 'quick'; // ë¹„íšŒì›ì¸ ê²½ìš° 'quick'ë¡œ ë³€í™˜
            }
            
            const scheduleTypeRadio = document.querySelector(`input[name="scheduleType"][value="${scheduleTypeValue}"]`);
            if (scheduleTypeRadio) {
                scheduleTypeRadio.checked = true;
            } else {
                console.warn('ì¼ì • ìœ í˜• ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', scheduleTypeValue);
            }
            
            // ì˜ˆì•½ ë©”ëª¨ ë¡œë“œ (ë¹ˆ ê°’ì´ë‚˜ "0"ì¸ ê²½ìš° ì²˜ë¦¬)
            const reservationMemo = reservationData.reservationMemo;
            if (reservationMemo && reservationMemo !== '0' && reservationMemo.trim() !== '') {
                document.getElementById('reservationMemo').value = reservationMemo;
            } else {
                document.getElementById('reservationMemo').value = '';
            }
            
            // êµìœ¡ ë©”ëª¨ ë¡œë“œ
            if (reservationData.educationMemos) {
                loadEducationMemos(reservationData.educationMemos);
            }
            
            // ì‹œí—˜ ì¼ì • ë¡œë“œ
            if (reservationData.functionTestDate) {
                const functionTestDate = document.getElementById('functionTestDate');
                if (functionTestDate) {
                    functionTestDate.value = reservationData.functionTestDate;
                    functionTestDate.style.background = '#fff';
                    functionTestDate.style.color = '#333';
                }
            }
            if (reservationData.roadTestDate) {
                const roadTestDate = document.getElementById('roadTestDate');
                if (roadTestDate) {
                    roadTestDate.value = reservationData.roadTestDate;
                    roadTestDate.style.background = '#fff';
                    roadTestDate.style.color = '#333';
                }
            }
            
            // íšŒì›ì´ ì„ íƒëœ ê²½ìš° ì—°ë½ì²˜ì™€ ì‹œí—˜ ì¼ì • ë¡œë“œ
            if (!isNonMember && reservationData.memberId) {
                loadMemberDetail(reservationData.memberId);
                
                // ì—°ë½ì²˜ í•„ë“œì— íšŒì›ì˜ ì „í™”ë²ˆí˜¸ ì„¤ì •
                const contactInput = document.getElementById('contactInput');
                if (contactInput) {
                    // íšŒì› ìƒì„¸ ì •ë³´ì—ì„œ ì „í™”ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
                    fetch(`api/debug_member_detail.php?id=${reservationData.memberId}`)
                        .then(response => response.json())
                        .then(result => {
                            if (result.success && result.member.phone) {
                                contactInput.value = result.member.phone;
                            }
                        })
                        .catch(error => {
                            console.error('ì—°ë½ì²˜ ë¡œë“œ ì˜¤ë¥˜:', error);
                        });
                }
            } else {
                // ë¹„íšŒì›ì¸ ê²½ìš° íšŒì› ìƒì„¸ ì •ë³´ ìˆ¨ê¸°ê¸°
                hideMemberDetail();
            }
            
            // ëª¨ë‹¬ì— ì˜ˆì•½ ë°ì´í„° ì €ì¥ (ë‚˜ì¤‘ì— ì‚¬ìš©) - reservationId í¬í•¨
            const fullReservationData = {
                ...reservationData,
                reservationId: reservationData.reservationId
            };
            modal.setAttribute('data-reservation', JSON.stringify(fullReservationData));
            console.log('ëª¨ë‹¬ì— ì €ì¥ëœ ì˜ˆì•½ ë°ì´í„°:', fullReservationData);
            
            // ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜
            document.getElementById('editModeButtons').style.display = 'flex';
            document.getElementById('normalModeButtons').style.display = 'none';
            
            // ìˆ˜ì • ëª¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            setupEditModeButtons();
            
            // íšŒì› ì„ íƒ ì´ë²¤íŠ¸ ì„¤ì •
            setupMemberSelectEvent();
            
            // êµìœ¡ ë©”ëª¨ ê¸°ëŠ¥ ì´ˆê¸°í™”
            setupEducationMemoFeature();
            
            // ì‹œí—˜ ì¼ì • í•„ë“œ ì´ë²¤íŠ¸ ì´ˆê¸°í™”
            setupTestScheduleFields();
            
            // ë¹„íšŒì›ì¸ ê²½ìš° ì—°ë½ì²˜ í•„ë“œ ë‹¤ì‹œ ì„¤ì • (ë‹¤ë¥¸ ì½”ë“œê°€ ë®ì–´ì“¸ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
            if (isNonMember) {
                const contactInput = document.getElementById('contactInput');
                if (contactInput && reservationData.contactPhone) {
                    contactInput.value = reservationData.contactPhone;
                }
            }
            
            // ëª¨ë‹¬ í‘œì‹œ
            modal.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.7) !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                z-index: 999999 !important;
                padding: 20px !important;
                box-sizing: border-box !important;
                visibility: visible !important;
                opacity: 1 !important;
            `;
            
            console.log('ì˜ˆì•½ ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œë¨');
        }
        
        // ì˜ˆì•½ ì‚­ì œ í•¨ìˆ˜
        function deleteReservation() {
            console.log('deleteReservation í•¨ìˆ˜ í˜¸ì¶œë¨');
            
            if (confirm('ì •ë§ë¡œ ì´ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const modal = document.getElementById('reservationModal');
                console.log('ëª¨ë‹¬ ì°¾ìŒ:', modal);
                
                const reservationDataStr = modal.getAttribute('data-reservation');
                console.log('ì˜ˆì•½ ë°ì´í„° ë¬¸ìì—´:', reservationDataStr);
                
                let reservationData = null;
                
                if (reservationDataStr) {
                    reservationData = JSON.parse(reservationDataStr);
                    console.log('ì˜ˆì•½ ë°ì´í„° íŒŒì‹±ë¨:', reservationData);
                    
                    // ì˜ˆì•½ ë¸”ë¡ ì œê±° - ê°•í™”ëœ ë°©ë²•
                    let blockRemoved = false;
                    
                    // ë°©ë²• 1: blockElementê°€ ìˆìœ¼ë©´ ì§ì ‘ ì œê±°
                    if (reservationData.blockElement && typeof reservationData.blockElement.remove === 'function') {
                        reservationData.blockElement.remove();
                        blockRemoved = true;
                    }
                    
                    // ë°©ë²• 2: blockElementê°€ ì—†ê±°ë‚˜ ì œê±° ì‹¤íŒ¨ ì‹œ ìœ„ì¹˜ë¡œ ì°¾ì•„ì„œ ì œê±°
                    if (!blockRemoved) {
                        const targetDay = reservationData.targetDay || 1;
                        const targetSeat = reservationData.targetSeat || 1;
                        const startTimeIndex = getTimeIndex(parseInt(reservationData.startHour), parseInt(reservationData.startMinute));
                        
                        console.log('ë¸”ë¡ ì¬ê²€ìƒ‰:', { targetDay, targetSeat, startTimeIndex });
                        
                        const targetSlot = document.querySelector(`[data-time-index="${startTimeIndex}"][data-day="${targetDay}"][data-seat="${targetSeat}"]`);
                        if (targetSlot) {
                            const existingBlock = targetSlot.querySelector('.reservation-block');
                            if (existingBlock) {
                                existingBlock.remove();
                                blockRemoved = true;
                            } else {
                            }
                        } else {
                        }
                    }
                    
                    // ë°©ë²• 3: ëª¨ë“  ì˜ˆì•½ ë¸”ë¡ ì¤‘ì—ì„œ í•´ë‹¹ reservationId ì°¾ì•„ì„œ ì œê±°
                    if (!blockRemoved) {
                        const reservationId = reservationData.reservationId;
                        const allBlocks = document.querySelectorAll('.reservation-block');
                        console.log('ëª¨ë“  ì˜ˆì•½ ë¸”ë¡ ê²€ìƒ‰ ì¤‘:', allBlocks.length, 'ê°œ');
                        
                        for (let block of allBlocks) {
                            const blockReservationId = block.getAttribute('data-reservation-id');
                            if (blockReservationId === reservationId.toString()) {
                                block.remove();
                                blockRemoved = true;
                                break;
                            }
                        }
                        
                        if (!blockRemoved) {
                        }
                    }
                } else {
                }
                
                // ì„œë²„ì—ì„œë„ ì‚­ì œ
                if (reservationData && reservationData.reservationId) {
                    const reservationId = reservationData.reservationId;
                    
                    deleteReservationFromServer(reservationId)
                    .then(result => {
                        closeModal();
                        alert('ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    })
                    .catch(error => {
                        
                        // ì„œë²„ ì‚­ì œê°€ ì‹¤íŒ¨í•´ë„ í™”ë©´ì—ì„œëŠ” ì œê±°
                        closeModal();
                        alert('ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (ì„œë²„ ë™ê¸°í™” ì‹¤íŒ¨)');
                    });
                } else {
                    closeModal();
                    alert('ì˜ˆì•½ IDê°€ ì—†ì–´ì„œ ì„œë²„ì—ì„œ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        // ê²°ì„ ì²˜ë¦¬ í•¨ìˆ˜
        function markAbsent() {
            console.log('ê²°ì„ ì²˜ë¦¬ ì‹œì‘');
            
            if (!currentReservationData) {
                alert('ì˜ˆì•½ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (confirm('ì´ ì˜ˆì•½ì„ ê²°ì„ìœ¼ë¡œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ê²°ì„ ì²˜ë¦¬í•  ë•Œ í˜„ì¬ ì˜ˆì•½ ë¸”ë¡ì˜ ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const blockElement = currentReservationData.blockElement;
                let targetDay = currentReservationData.targetDay;
                let targetSeat = currentReservationData.targetSeat;
                
                // blockElementì—ì„œ ì§ì ‘ ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                if (blockElement) {
                    const parentSlot = blockElement.closest('.reservation-slot');
                    if (parentSlot) {
                        targetDay = parseInt(parentSlot.getAttribute('data-day')) || targetDay;
                        targetSeat = parseInt(parentSlot.getAttribute('data-seat')) || targetSeat;
                        console.log('ê²°ì„ ì²˜ë¦¬ - ë¸”ë¡ì—ì„œ ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜´:', { targetDay, targetSeat });
                    }
                }
                
                console.log('ê²°ì„ ì²˜ë¦¬ - ìµœì¢… ìœ„ì¹˜ ì •ë³´:', { 
                    originalTargetDay: currentReservationData.targetDay,
                    originalTargetSeat: currentReservationData.targetSeat,
                    finalTargetDay: targetDay,
                    finalTargetSeat: targetSeat
                });
                
                // ì„œë²„ì—ì„œ ì˜ˆì•½ì„ ê²°ì„ ì²˜ë¦¬ë¡œ ì—…ë°ì´íŠ¸ (íšŒì› ì´ë¦„ê³¼ ìœ„ì¹˜ ì •ë³´ ìœ ì§€)
                updateReservationOnServer(currentReservationData.reservationId, {
                    ...currentReservationData,
                    scheduleType: 'absent',
                    targetDay: targetDay,
                    targetSeat: targetSeat
                }).then(() => {
                    // ì˜ˆì•½ ë¸”ë¡ì„ ê²°ì„ ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½
                    if (currentReservationData.blockElement) {
                        // ê¸°ì¡´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì œê±°
                        currentReservationData.blockElement.classList.remove('custom', 'time', 'none', 'unlimited', 'course');
                        // ê²°ì„ í´ë˜ìŠ¤ ì¶”ê°€
                        currentReservationData.blockElement.classList.add('absent');
                        currentReservationData.blockElement.className = 'reservation-block absent';
                        // ê²°ì„ ì²˜ë¦¬ ì‹œì—ë„ íšŒì› ì´ë¦„ë§Œ í‘œì‹œ
                        currentReservationData.blockElement.textContent = currentReservationData.memberName || 'ê²°ì„';
                    }
                    
                    closeModal();
                    console.log('ê²°ì„ ì²˜ë¦¬ë¨:', currentReservationData);
                    alert('ê²°ì„ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }).catch(error => {
                    console.error('ê²°ì„ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
                    alert('ê²°ì„ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
            }
        }
        
        // ì˜ˆì•½ ìˆ˜ì • í•¨ìˆ˜
        function updateReservation() {
            const modal = document.getElementById('reservationModal');
            const reservationData = currentReservationData || JSON.parse(modal.getAttribute('data-reservation'));
            
            // ìˆ˜ì •ëœ ë°ì´í„° ìˆ˜ì§‘
            const memberSearchInput = document.getElementById('memberSearchInput');
            const selectedMemberId = document.getElementById('selectedMemberId');
            
            const updatedData = {
                memberName: memberSearchInput ? memberSearchInput.value : 'ìƒˆ ì˜ˆì•½',
                memberId: selectedMemberId ? selectedMemberId.value : null,
                memberType: document.querySelector('input[name="memberType"]:checked').value,
                startHour: document.getElementById('startHour').value,
                startMinute: document.getElementById('startMinute').value,
                endHour: document.getElementById('endHour').value,
                endMinute: document.getElementById('endMinute').value,
                scheduleType: document.querySelector('input[name="scheduleType"]:checked').value,
                contactPhone: document.getElementById('contactInput') ? document.getElementById('contactInput').value : '',
                reservationMemo: document.getElementById('reservationMemo').value,
                educationMemos: getEducationMemos(),
                functionTestDate: document.getElementById('functionTestDate').value,
                roadTestDate: document.getElementById('roadTestDate').value,
                targetDay: reservationData.targetDay,
                targetSeat: reservationData.targetSeat,
                productName: reservationData.productName,
                productHours: reservationData.productHours
            };
            
            console.log('ì˜ˆì•½ ìˆ˜ì •ë¨:', updatedData);
            
            // ì„œë²„ì— ì˜ˆì•½ ìˆ˜ì • ìš”ì²­
            if (reservationData.reservationId) {
                updateReservationOnServer(reservationData.reservationId, updatedData)
                .then(result => {
                    console.log('ì„œë²„ ì˜ˆì•½ ìˆ˜ì • ì„±ê³µ:', result);
                    alert('ì˜ˆì•½ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    closeModal();
                })
                .catch(error => {
                    console.error('ì„œë²„ ì˜ˆì•½ ìˆ˜ì • ì‹¤íŒ¨:', error);
                    alert('ì˜ˆì•½ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                });
            } else {
                console.warn('ì˜ˆì•½ IDê°€ ì—†ì–´ì„œ ì„œë²„ ì—…ë°ì´íŠ¸ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.');
            }
            
            // ì˜ˆì•½ ë¸”ë¡ ì—…ë°ì´íŠ¸
            let blockElement = reservationData.blockElement;
            
            // blockElementê°€ DOM ìš”ì†Œê°€ ì•„ë‹Œ ê²½ìš° ì°¾ê¸°
            if (!blockElement || !blockElement.setAttribute) {
                // ì˜ˆì•½ ë¸”ë¡ì„ ë‹¤ì‹œ ì°¾ê¸°
                const allBlocks = document.querySelectorAll('.reservation-block');
                for (let block of allBlocks) {
                    if (block.getAttribute('data-reservation-id') == reservationData.reservationId) {
                        blockElement = block;
                        break;
                    }
                }
            }
            
            if (blockElement && blockElement.setAttribute) {
                // ì´ë¦„ë§Œ í‘œì‹œ
                blockElement.textContent = updatedData.memberName;
                
                // íšŒì› ID ì—…ë°ì´íŠ¸
                if (updatedData.memberId) {
                    blockElement.setAttribute('data-member-id', updatedData.memberId);
                } else {
                    blockElement.removeAttribute('data-member-id');
                }
                
                // ì˜ˆì•½ ë©”ëª¨ ì—…ë°ì´íŠ¸
                if (updatedData.reservationMemo) {
                    blockElement.setAttribute('data-reservation-memo', updatedData.reservationMemo);
                } else {
                    blockElement.removeAttribute('data-reservation-memo');
                }
                
                // êµìœ¡ ë©”ëª¨ ì—…ë°ì´íŠ¸
                if (updatedData.educationMemos && updatedData.educationMemos.length > 0) {
                    blockElement.setAttribute('data-education-memos', JSON.stringify(updatedData.educationMemos));
                } else {
                    blockElement.removeAttribute('data-education-memos');
                }
                
                // ì‹œí—˜ ì¼ì • ì—…ë°ì´íŠ¸
                if (updatedData.functionTestDate) {
                    blockElement.setAttribute('data-function-test-date', updatedData.functionTestDate);
                } else {
                    blockElement.removeAttribute('data-function-test-date');
                }
                
                if (updatedData.roadTestDate) {
                    blockElement.setAttribute('data-road-test-date', updatedData.roadTestDate);
                } else {
                    blockElement.removeAttribute('data-road-test-date');
                }
                
                // ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                const scheduleType = updatedData.scheduleType;
                const productName = updatedData.productName;
                const productHours = updatedData.productHours;
                
                
                const newColorClass = determineColorClass(scheduleType, productName, productHours);
                
                // ê¸°ì¡´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì œê±°
                blockElement.classList.remove('custom', 'time', 'none', 'unlimited', 'course', 'absent');
                // ìƒˆë¡œìš´ ìƒ‰ìƒ í´ë˜ìŠ¤ ì¶”ê°€
                blockElement.classList.add(newColorClass);
                blockElement.className = `reservation-block ${newColorClass}`;
                
                // ì¸ë¼ì¸ background ìŠ¤íƒ€ì¼ ì œê±° (CSS í´ë˜ìŠ¤ê°€ ìš°ì„ ë˜ë„ë¡)
                blockElement.style.removeProperty('background');
                blockElement.style.removeProperty('background-color');
                
            }
            
            closeModal();
            alert('ì˜ˆì•½ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        // ì˜ˆì•½ ì‹œê°„ ê³„ì‚° í•¨ìˆ˜
        function calculateReservationHours(startHour, startMinute, endHour, endMinute) {
            const startTime = parseInt(startHour) * 60 + parseInt(startMinute);
            const endTime = parseInt(endHour) * 60 + parseInt(endMinute);
            const durationMinutes = endTime - startTime;
            return Math.max(0, durationMinutes / 60); // ì‹œê°„ ë‹¨ìœ„ë¡œ ë°˜í™˜
        }

        async function saveReservation(buttonType = 'immediate') {
            console.log('ì˜ˆì•½ ì €ì¥');
            
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            const searchInput = document.getElementById('memberSearchInput');
            const selectedMemberId = document.getElementById('selectedMemberId');
            let memberName = 'ìƒˆ ì˜ˆì•½';
            let memberId = null;
            
            if (searchInput && selectedMemberId) {
                memberName = searchInput.value || 'ìƒˆ ì˜ˆì•½';
                memberId = selectedMemberId.value || null;
            }
            const memberType = document.querySelector('input[name="memberType"]:checked')?.value || 'existing';
            let scheduleType = document.querySelector('input[name="scheduleType"]:checked')?.value || 'course';
            
            // ë¹„íšŒì›ì¼ ë•ŒëŠ” scheduleTypeì„ 'no-product'ë¡œ ì„¤ì •
            if (memberType === 'quick') {
                scheduleType = 'no-product';
            }
            const startHour = document.getElementById('startHour')?.value || '09';
            const startMinute = document.getElementById('startMinute')?.value || '00';
            const endHour = document.getElementById('endHour')?.value || '10';
            const endMinute = document.getElementById('endMinute')?.value || '00';
            const reservationMemo = document.getElementById('reservationMemo')?.value || '';
            const educationMemos = getEducationMemos();
            const functionTestDate = document.getElementById('functionTestDate')?.value || '';
            const roadTestDate = document.getElementById('roadTestDate')?.value || '';
            const productName = document.getElementById('productInput')?.value || '';
            const contactPhone = document.getElementById('contactInput')?.value || '';
            
            // íšŒì›ì˜ product_hours ê°€ì ¸ì˜¤ê¸°
            let productHours = 0;
            if (memberType === 'quick') {
                // ë¹„íšŒì›ì¼ ë•ŒëŠ” productHoursë¥¼ 0ìœ¼ë¡œ ì„¤ì •
                productHours = 0;
                console.log('ë¹„íšŒì›: product_hoursë¥¼ 0ìœ¼ë¡œ ì„¤ì •');
            } else if (memberId) {
                // íšŒì›ì¸ ê²½ìš° ì„œë²„ì—ì„œ ìµœì‹  ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                try {
                    const memberResponse = await fetch(`api/debug_member_detail.php?id=${memberId}`);
                    const memberResult = await memberResponse.json();
                    if (memberResult.success && memberResult.member) {
                        productHours = memberResult.member.product_hours || 0;
                        console.log('ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ íšŒì›ì˜ product_hours:', productHours);
                    } else {
                        console.warn('íšŒì› ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ, ê¸°ë³¸ê°’ 0 ì‚¬ìš©');
                        productHours = 0;
                    }
                } catch (error) {
                    console.error('íšŒì› ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    productHours = 0;
                }
            }
            
            // ì˜ˆì•½ ì‹œê°„ ê³„ì‚°
            const reservationHours = calculateReservationHours(startHour, startMinute, endHour, endMinute);
            
            // ì˜ˆì•½ ë°ì´í„°ë¥¼ ì„œë²„ì— ì €ì¥
            // ë“œë˜ê·¸í•œ ì¢Œì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const targetSeat = reservationInfo.seat || 1;
            const targetDay = reservationInfo.day || dragState.startDay || 1;
            
            console.log('ì˜ˆì•½ ì €ì¥í•  ìœ„ì¹˜ ì •ë³´:', { 
                targetDay, 
                targetSeat,
                reservationInfo: reservationInfo,
                dragState: dragState,
                ìµœì¢…ì‚¬ìš©ê°’: { targetDay, targetSeat }
            });
            
            // ì˜ˆì•½ì¼ í•„ë“œì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
            const reservationDateInput = document.getElementById('reservationDate');
            const reservationDate = reservationDateInput ? reservationDateInput.value : null;
            
            console.log('ì˜ˆì•½ì¼ í•„ë“œ ê°’:', reservationDate);
            console.log('currentReservationData í™•ì¸:', currentReservationData);
            
            try {
                const reservationId = await saveReservationToServer({
                    memberId: memberId,
                    memberName: memberName,
                    memberType: memberType,
                    scheduleType: scheduleType,
                    startHour: startHour,
                    startMinute: startMinute,
                    endHour: endHour,
                    endMinute: endMinute,
                    reservationHours: reservationHours, // ì˜ˆì•½ ì‹œê°„ ì¶”ê°€
                    targetDay: targetDay,
                    targetSeat: targetSeat,
                    reservationDate: reservationDate, // ì˜ˆì•½ ë‚ ì§œ ì¶”ê°€
                    reservationMemo: reservationMemo,
                    educationMemos: educationMemos,
                    functionTestDate: functionTestDate,
                    roadTestDate: roadTestDate,
                    productName: productName,
                    productHours: productHours,
                    contactPhone: contactPhone // ì—°ë½ì²˜ ì •ë³´ ì¶”ê°€
                });
                
                // ì˜ˆì•½ ë¸”ë¡ ìƒì„± (ì„œë²„ ID í¬í•¨) - ì˜¬ë°”ë¥¸ ìœ„ì¹˜ë¡œ
                console.log('createReservationBlock í˜¸ì¶œ ì‹œ ì „ë‹¬ë˜ëŠ” ìœ„ì¹˜:', { targetDay, targetSeat });
                createReservationBlock(memberName, memberId, memberType, scheduleType, startHour, startMinute, endHour, endMinute, reservationMemo, educationMemos, functionTestDate, roadTestDate, reservationId, targetDay, targetSeat, productName, productHours, contactPhone);
                
                // ê³„ì† ì˜ˆì•½ì„ ìœ„í•œ íšŒì› ì •ë³´ ì €ì¥ (ê¸°ë³¸ ì •ë³´ë§Œ)
                if (buttonType === 'continue') {
                    lastReservationMember = {
                        memberName: memberName,
                        memberId: memberId,
                        memberType: memberType,
                        scheduleType: scheduleType,
                        contactPhone: contactPhone,
                        productName: productName,
                        productHours: productHours
                    };
                    console.log('ê³„ì† ì˜ˆì•½ì„ ìœ„í•œ íšŒì› ì •ë³´ ì €ì¥:', lastReservationMember);
                } else {
                    // ë°”ë¡œ ì˜ˆì•½ì¸ ê²½ìš° íšŒì› ì •ë³´ ì´ˆê¸°í™”
                    lastReservationMember = null;
                }
                
                // êµìœ¡ ë©”ëª¨ëŠ” save_reservation.phpì—ì„œ ìë™ìœ¼ë¡œ íšŒì› í…Œì´ë¸”ì— ì €ì¥ë©ë‹ˆë‹¤
                
                alert('ì˜ˆì•½ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeModal();
            } catch (error) {
                console.error('ì˜ˆì•½ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ì˜ˆì•½ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ì‹¤ì œ ì˜ˆì•½ ë¸”ë¡ ìƒì„± í•¨ìˆ˜
        function createReservationBlock(memberName, memberId, memberType, scheduleType, startHour, startMinute, endHour, endMinute, reservationMemo, educationMemos, functionTestDate, roadTestDate, reservationId = null, targetDay = null, targetSeat = null, productName = null, productHours = 0, contactPhone = '') {
            console.log('ì˜ˆì•½ ë¸”ë¡ ìƒì„± ì‹œì‘:', {
                memberName, memberType, scheduleType, 
                startHour, startMinute, endHour, endMinute,
                ì „ë‹¬ë°›ì€targetDay: targetDay,
                ì „ë‹¬ë°›ì€targetSeat: targetSeat,
                dragState: dragState
            });
            
            // ì‹œê°„ ê°’ì´ ìœ íš¨í•˜ì§€ ì•Šì€ ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì •
            if (!startHour || startHour === '' || startHour === 'null' || startHour === null) {
                console.warn('startHourê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ, ê¸°ë³¸ê°’ 9ë¡œ ì„¤ì •:', startHour);
                startHour = '9';
            }
            if (!startMinute || startMinute === '' || startMinute === 'null' || startMinute === null) {
                console.warn('startMinuteê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ, ê¸°ë³¸ê°’ 0ìœ¼ë¡œ ì„¤ì •:', startMinute);
                startMinute = '0';
            }
            if (!endHour || endHour === '' || endHour === 'null' || endHour === null) {
                console.warn('endHourê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ, ê¸°ë³¸ê°’ 10ìœ¼ë¡œ ì„¤ì •:', endHour);
                endHour = '10';
            }
            if (!endMinute || endMinute === '' || endMinute === 'null' || endMinute === null) {
                console.warn('endMinuteê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ, ê¸°ë³¸ê°’ 0ìœ¼ë¡œ ì„¤ì •:', endMinute);
                endMinute = '0';
            }
            
            // ì‹œê°„ì„ ì¸ë±ìŠ¤ë¡œ ë³€í™˜ (30ë¶„ ì¶”ê°€í•˜ì§€ ì•ŠìŒ)
            const startTimeIndex = getTimeIndex(startHour, startMinute);
            const endTimeIndex = getTimeIndex(endHour, endMinute);
            
            console.log('ì‹œê°„ ì¸ë±ìŠ¤:', { startTimeIndex, endTimeIndex });
            
            if (startTimeIndex === -1 || endTimeIndex === -1) {
                console.error('ì˜ëª»ëœ ì‹œê°„ í˜•ì‹:', {
                    startHour, startMinute, endHour, endMinute,
                    startTimeIndex, endTimeIndex
                });
                alert('ì‹œê°„ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì‹¤ì œ ë‚ ì§œ ê³„ì‚° (targetDayë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ì£¼ì˜ í•´ë‹¹ ìš”ì¼ ë‚ ì§œ ê³„ì‚°)
            let actualDate = null;
            if (targetDay !== null && targetDay !== undefined) {
                const currentWeek = getCurrentWeek();
                // targetDayëŠ” 1-7ì´ì§€ë§Œ ë°°ì—´ ì¸ë±ìŠ¤ëŠ” 0-6ì´ë¯€ë¡œ 1ì„ ë¹¼ì•¼ í•¨
                const dayIndex = targetDay - 1;
                actualDate = new Date(currentWeek[dayIndex]);
                console.log('ğŸ” ì‹¤ì œ ë‚ ì§œ ê³„ì‚°:', {
                    targetDay: targetDay,
                    dayIndex: dayIndex,
                    currentWeek: currentWeek.map(d => d.toISOString().split('T')[0]),
                    selectedDate: currentWeek[dayIndex],
                    actualDate: actualDate,
                    dateString: actualDate.toISOString().split('T')[0],
                    ìš”ì¼: ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'][dayIndex],
                    currentWeekStart: currentWeekStart ? currentWeekStart.toISOString().split('T')[0] : 'null'
                });
            } else {
            }

            // ìƒ‰ìƒ í´ë˜ìŠ¤ ê²°ì •
            const colorClass = determineColorClass(scheduleType, productName, productHours);
            
            // ì˜ˆì•½ ë¸”ë¡ ìƒì„±
            const block = document.createElement('div');
            block.className = `reservation-block ${colorClass}`;
            block.style.position = 'absolute';
            block.style.left = '2px';
            block.style.right = '2px';
            block.style.top = '0px';
            block.style.height = ((endTimeIndex - startTimeIndex) * 60) + 'px';
            block.style.zIndex = '10';
            block.style.width = 'calc(100% - 4px)'; // left + right = 4px
            block.style.boxSizing = 'border-box';
            // backgroundëŠ” CSS í´ë˜ìŠ¤ì—ì„œ ì²˜ë¦¬í•˜ë¯€ë¡œ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ì„¤ì •í•˜ì§€ ì•ŠìŒ
            // ì´ë¦„ë§Œ í‘œì‹œ
            block.textContent = memberName;
            block.style.color = 'white';
            block.style.fontSize = '11px';
            block.style.display = 'flex';
            block.style.alignItems = 'center';
            block.style.justifyContent = 'center';
            block.style.borderRadius = '4px';
            block.style.padding = '2px 4px';
            block.style.minHeight = '28px';
            
            // ì„œë²„ ID ì €ì¥
            if (reservationId) {
                block.setAttribute('data-reservation-id', reservationId);
            }
            
            // íšŒì› ID ì €ì¥
            if (memberId) {
                block.setAttribute('data-member-id', memberId);
            }
            
            // ì—°ë½ì²˜ ì €ì¥
            if (contactPhone) {
                block.setAttribute('data-contact-phone', contactPhone);
            }
            
            // ì‹¤ì œ ë‚ ì§œ ì €ì¥
            if (actualDate) {
                block.setAttribute('data-actual-date', actualDate.toISOString().split('T')[0]);
                console.log('ë¸”ë¡ì— ì‹¤ì œ ë‚ ì§œ ì €ì¥:', actualDate.toISOString().split('T')[0]);
            }
            
            // ì˜ˆì•½ ë©”ëª¨ ì €ì¥
            if (reservationMemo) {
                block.setAttribute('data-reservation-memo', reservationMemo);
            }
            
            // êµìœ¡ ë©”ëª¨ ì €ì¥
            if (educationMemos && educationMemos.length > 0) {
                block.setAttribute('data-education-memos', JSON.stringify(educationMemos));
            }
            
            // ì‹œí—˜ ì¼ì • ì €ì¥
            if (functionTestDate) {
                block.setAttribute('data-function-test-date', functionTestDate);
            }
            if (roadTestDate) {
                block.setAttribute('data-road-test-date', roadTestDate);
            }
            
            // ì‹œê°„ ì°¨ê°ì„ ìœ„í•œ ë°ì´í„° ì†ì„± ì €ì¥
            block.setAttribute('data-member-type', memberType);
            block.setAttribute('data-schedule-type', scheduleType);
            block.setAttribute('data-product-hours', productHours);
            block.setAttribute('data-start-hour', startHour);
            block.setAttribute('data-start-minute', startMinute);
            block.setAttribute('data-end-hour', endHour);
            block.setAttribute('data-end-minute', endMinute);
            block.setAttribute('data-target-day', targetDay);
            
            // ë“œë˜ê·¸í•œ ìš”ì¼ê³¼ ì¢Œì„ì— ì¶”ê°€
            console.log('ğŸ” reservationInfo í™•ì¸:', reservationInfo);
            console.log('ğŸ” dragState í™•ì¸:', dragState);
            console.log('ğŸ” ì „ë‹¬ë°›ì€ targetDay, targetSeat:', { targetDay, targetSeat });
            
            // ìƒˆë¡œê³ ì¹¨ ì‹œì—ëŠ” ì „ë‹¬ë°›ì€ ê°’ ì‚¬ìš©, ë“œë˜ê·¸ ì‹œì—ëŠ” reservationInfo ì‚¬ìš©
            let finalTargetDay, finalTargetSeat;
            
            if (reservationInfo && reservationInfo.day && reservationInfo.seat) {
                // ë“œë˜ê·¸ë¡œ ìƒì„±ëœ ê²½ìš°: reservationInfo ì‚¬ìš©
                finalTargetDay = reservationInfo.day;
                finalTargetSeat = reservationInfo.seat;
                console.log('ğŸ”§ ë“œë˜ê·¸ë¡œ ìƒì„±: reservationInfo ê°’ ì‚¬ìš©:', {
                    reservationInfoDay: reservationInfo.day,
                    reservationInfoSeat: reservationInfo.seat,
                    ìµœì¢…targetDay: finalTargetDay,
                    ìµœì¢…targetSeat: finalTargetSeat
                });
            } else {
                // ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ë¡œë“œëœ ê²½ìš°: ì „ë‹¬ë°›ì€ ê°’ ì‚¬ìš©
                finalTargetDay = targetDay || 1;
                finalTargetSeat = targetSeat || 1;
                console.log('ğŸ”§ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ë¡œë“œ: ì „ë‹¬ë°›ì€ ê°’ ì‚¬ìš©:', {
                    ì „ë‹¬ë°›ì€targetDay: targetDay,
                    ì „ë‹¬ë°›ì€targetSeat: targetSeat,
                    ìµœì¢…targetDay: finalTargetDay,
                    ìµœì¢…targetSeat: finalTargetSeat
                });
            }
            
            // ìµœì¢… ê°’ ìœ íš¨ì„± ê²€ì‚¬
            if (finalTargetDay < 1 || finalTargetDay > 7) {
                console.warn('ì˜ëª»ëœ finalTargetDay ê°’:', finalTargetDay, 'ê¸°ë³¸ê°’ 1ë¡œ ì„¤ì •');
                finalTargetDay = 1;
            }
            if (finalTargetSeat < 1 || finalTargetSeat > 6) {
                console.warn('ì˜ëª»ëœ finalTargetSeat ê°’:', finalTargetSeat, 'ê¸°ë³¸ê°’ 1ë¡œ ì„¤ì •');
                finalTargetSeat = 1;
            }
            
            console.log('ìµœì¢… ìœ„ì¹˜ ê³„ì‚°:', {
                ì „ë‹¬ë°›ì€targetDay: targetDay,
                ì „ë‹¬ë°›ì€targetSeat: targetSeat,
                reservationInfoDay: reservationInfo.day,
                reservationInfoSeat: reservationInfo.seat,
                ìµœì¢…targetDay: finalTargetDay,
                ìµœì¢…targetSeat: finalTargetSeat
            });
            
            console.log('ğŸ”§ ìµœì¢… targetDay, targetSeat:', { finalTargetDay, finalTargetSeat });
            
            console.log('ğŸ” ì˜ˆì•½ ë¸”ë¡ ìƒì„± ì •ë³´:', {
                startTimeIndex, endTimeIndex, finalTargetDay, finalTargetSeat,
                dragState: dragState,
                timeSlots: timeSlots.slice(0, 5) // ì²˜ìŒ 5ê°œë§Œ í‘œì‹œ
            });
            
            const targetSlot = document.querySelector(`[data-time-index="${startTimeIndex}"][data-day="${finalTargetDay}"][data-seat="${finalTargetSeat}"]`);
            console.log('ğŸ” ëŒ€ìƒ ìŠ¬ë¡¯ ì°¾ê¸°:', {
                selector: `[data-time-index="${startTimeIndex}"][data-day="${finalTargetDay}"][data-seat="${finalTargetSeat}"]`,
                startTimeIndex, finalTargetDay, finalTargetSeat,
                found: !!targetSlot,
                targetSlot: targetSlot
            });
            
            // ë§Œì•½ ìŠ¬ë¡¯ì„ ì°¾ì§€ ëª»í–ˆë‹¤ë©´ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì°¾ê¸°
            if (!targetSlot) {
                const alternativeSlot = document.querySelector(`[data-time-index="${startTimeIndex}"][data-day="${finalTargetDay}"][data-seat="${finalTargetSeat}"]`);
                if (alternativeSlot) {
                }
            }
            
            // ëª¨ë“  ê°€ëŠ¥í•œ ìŠ¬ë¡¯ í™•ì¸
            const allSlots = document.querySelectorAll(`[data-time-index="${startTimeIndex}"]`);
            
            // ìŠ¬ë¡¯ì´ ì—†ìœ¼ë©´ ìƒì„±í•˜ì§€ ì•ŠìŒ
            if (allSlots.length === 0) {
                return;
            }
            
            // ìµœì¢… ìŠ¬ë¡¯ ê²°ì • - reservationInfo ìš°ì„  ì‚¬ìš©
            let finalSlot = document.querySelector(`[data-time-index="${startTimeIndex}"][data-day="${finalTargetDay}"][data-seat="${finalTargetSeat}"]`);
            
            // í—¤ë” ì˜ì—­ì¸ì§€ í™•ì¸
            if (startTimeIndex === -1 || !finalSlot || finalSlot.closest('.calendar-header')) {
                
                // ë‹¤ë¥¸ ìœ„ì¹˜ì—ì„œ ìŠ¬ë¡¯ ì°¾ê¸° ì‹œë„ (í—¤ë”ê°€ ì•„ë‹Œ ì²« ë²ˆì§¸ ìŠ¬ë¡¯)
                const alternativeSlots = document.querySelectorAll(`[data-time-index="${startTimeIndex}"]`);
                let validSlot = null;
                
                for (let slot of alternativeSlots) {
                    if (!slot.closest('.calendar-header') && slot.classList.contains('reservation-slot')) {
                        validSlot = slot;
                        break;
                    }
                }
                
                if (validSlot) {
                    console.log('ëŒ€ì²´ ìŠ¬ë¡¯ ë°œê²¬, í•´ë‹¹ ìœ„ì¹˜ì— ìƒì„±:', validSlot);
                    validSlot.appendChild(block);
                    return;
                } else {
                    console.error('ì ì ˆí•œ ìŠ¬ë¡¯ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
            }
            
            // ì‹œê°„ ìŠ¬ë¡¯ì´ ì•„ë‹Œ ê²½ìš°ë„ ì°¨ë‹¨
            if (!finalSlot.classList.contains('reservation-slot')) {
                console.error('ì‹œê°„ ìŠ¬ë¡¯ì´ ì•„ë‹Œ ì˜ì—­ì—ëŠ” ì˜ˆì•½ ë¸”ë¡ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (finalSlot) {
                // ê¸°ì¡´ ì˜ˆì•½ ë¸”ë¡ ì œê±° (ë” ì•ˆì „í•˜ê²Œ)
                const existingBlocks = finalSlot.querySelectorAll('.reservation-block');
                existingBlocks.forEach(existingBlock => {
                    if (existingBlock.parentNode) {
                        existingBlock.parentNode.removeChild(existingBlock);
                    }
                });
                
                // ì¤‘ë³µ ë°©ì§€: ê°™ì€ ì‹œê°„ëŒ€ì— ê°™ì€ íšŒì›ì˜ ì˜ˆì•½ì´ ìˆëŠ”ì§€ í™•ì¸
                const conflictingBlocks = document.querySelectorAll(`[data-time-index="${startTimeIndex}"][data-day="${finalTargetDay}"] .reservation-block`);
                if (conflictingBlocks.length > 0) {
                    // ê°™ì€ íšŒì›ì˜ ì˜ˆì•½ë§Œ ì œê±°
                    const sameMemberBlocks = Array.from(conflictingBlocks).filter(block => 
                        block.getAttribute('data-member-id') === memberId
                    );
                    
                    if (sameMemberBlocks.length > 0) {
                        console.warn('ê°™ì€ ì‹œê°„ëŒ€ì— ê°™ì€ íšŒì›ì˜ ì˜ˆì•½ì´ ì¡´ì¬í•©ë‹ˆë‹¤. ì œê±° í›„ ì§„í–‰í•©ë‹ˆë‹¤.');
                        sameMemberBlocks.forEach(block => {
                            if (block.parentNode) {
                                block.parentNode.removeChild(block);
                            }
                        });
                    } else {
                        console.log('ë‹¤ë¥¸ íšŒì›ì˜ ì˜ˆì•½ì´ ìˆì§€ë§Œ, ê°™ì€ íšŒì›ì´ ì•„ë‹ˆë¯€ë¡œ ê·¸ëŒ€ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.');
                    }
                }
                
                // ì¶”ê°€ ì•ˆì „ì¥ì¹˜: ê°™ì€ ìŠ¬ë¡¯ì— ìˆëŠ” ê°™ì€ íšŒì›ì˜ ë¸”ë¡ë§Œ ì œê±°
                const allBlocksInSlot = finalSlot.querySelectorAll('.reservation-block');
                const sameMemberBlocksInSlot = Array.from(allBlocksInSlot).filter(block => 
                    block.getAttribute('data-member-id') === memberId
                );
                
                sameMemberBlocksInSlot.forEach(block => {
                    if (block.parentNode) {
                        block.parentNode.removeChild(block);
                    }
                });
                
                // ìŠ¬ë¡¯ ìŠ¤íƒ€ì¼ ê°•ì œ ì„¤ì •
                finalSlot.style.position = 'relative';
                finalSlot.style.overflow = 'visible';
                finalSlot.style.zIndex = '1';
                finalSlot.style.minHeight = '60px'; // ìµœì†Œ ë†’ì´ ë³´ì¥
                
                // ì˜ˆì•½ ë¸”ë¡ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                block.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // ë¸”ë¡ì´ ìˆëŠ” ìŠ¬ë¡¯ì—ì„œ targetDay ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    const slotTargetDay = finalSlot.getAttribute('data-day');
                    // data-dayëŠ” 1(ì›”ìš”ì¼)~7(ì¼ìš”ì¼), targetDayëŠ” 0(ì›”ìš”ì¼)~6(ì¼ìš”ì¼)
                    const actualTargetDay = slotTargetDay ? parseInt(slotTargetDay) - 1 : targetDay;
                    
                    console.log('ì˜ˆì•½ ë¸”ë¡ í´ë¦­ë¨:', {
                        memberName, memberType, scheduleType,
                        startHour, startMinute, endHour, endMinute,
                        targetDay, actualTargetDay, targetSeat,
                        slotTargetDay: slotTargetDay
                    });
                    
                    // ê¸°ì¡´ ì˜ˆì•½ ì •ë³´ë¡œ ëª¨ë‹¬ ì—´ê¸° (ìˆ˜ì • ëª¨ë“œ)
                    const memberId = block.getAttribute('data-member-id');
                    const reservationId = block.getAttribute('data-reservation-id');
                    const reservationMemo = block.getAttribute('data-reservation-memo') || '';
                    const educationMemosStr = block.getAttribute('data-education-memos');
                    const functionTestDate = block.getAttribute('data-function-test-date') || '';
                    const roadTestDate = block.getAttribute('data-road-test-date') || '';
                    const contactPhone = block.getAttribute('data-contact-phone') || '';
                    const actualDate = block.getAttribute('data-actual-date') || '';
                    let educationMemos = [];
                    
                    console.log('ë¸”ë¡ì—ì„œ ê°€ì ¸ì˜¨ ì‹¤ì œ ë‚ ì§œ:', actualDate);
                    
                    if (educationMemosStr) {
                        try {
                            educationMemos = JSON.parse(educationMemosStr);
                        } catch (e) {
                            console.error('êµìœ¡ ë©”ëª¨ íŒŒì‹± ì˜¤ë¥˜:', e);
                        }
                    }
                    
                    openReservationEditModal({
                        memberName, memberId, memberType, scheduleType,
                        startHour, startMinute, endHour, endMinute,
                        targetDay: actualTargetDay, targetSeat, reservationMemo, educationMemos,
                        functionTestDate, roadTestDate, reservationId,
                        contactPhone, productName, productHours, actualDate, blockElement: block
                    });
                });
                
                // ë¸”ë¡ì„ ì¶”ê°€í•˜ê¸° ì „ì— í•œ ë²ˆ ë” í™•ì¸
                const duplicateBlocks = finalSlot.querySelectorAll('.reservation-block');
                duplicateBlocks.forEach(dupBlock => {
                    if (dupBlock.parentNode) {
                        dupBlock.parentNode.removeChild(dupBlock);
                    }
                });
                
                finalSlot.appendChild(block);
                
                // ë¸”ë¡ ìœ„ì¹˜ ê°•ì œ ì¬ê³„ì‚°
                setTimeout(() => {
                    block.style.position = 'absolute';
                    block.style.left = '2px';
                    block.style.right = '2px';
                    block.style.top = '0px';
                    block.style.width = 'calc(100% - 4px)';
                }, 10);
                
                console.log('ì˜ˆì•½ ë¸”ë¡ ì¶”ê°€ë¨:', {
                    targetSlot: targetSlot,
                    block: block,
                    position: targetSlot.getBoundingClientRect(),
                    day: targetDay,
                    seat: targetSeat,
                    timeIndex: startTimeIndex
                });
            } else {
                console.error('ëŒ€ìƒ ìŠ¬ë¡¯ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', {
                    startTimeIndex, targetDay, targetSeat,
                    selector: `[data-time-index="${startTimeIndex}"][data-day="${targetDay}"][data-seat="${targetSeat}"]`
                });
            }
        }
        
        // ì‹œê°„ì„ ì¸ë±ìŠ¤ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function getTimeIndex(hour, minute) {
            // ì‹œê°„ê³¼ ë¶„ì„ ì •ìˆ˜ë¡œ ë³€í™˜
            const h = parseInt(hour);
            const m = parseInt(minute);
            
            // timeSlots ë°°ì—´ í˜•ì‹ì— ë§ê²Œ ì‹œê°„ ë¬¸ìì—´ ìƒì„±
            let timeString;
            if (h < 10) {
                timeString = `${h}:${m.toString().padStart(2, '0')}`;
            } else {
                timeString = `${h}:${m.toString().padStart(2, '0')}`;
            }
            
            console.log('ì‹œê°„ ë³€í™˜ ì‹œë„:', timeString);
            console.log('timeSlots ë°°ì—´:', timeSlots);
            
            const index = timeSlots.indexOf(timeString);
            console.log('ì°¾ì€ ì¸ë±ìŠ¤:', index);
            
            return index;
        }
        
        
        
        // ì‹œê°„ í‘œì‹œê¸° ìƒì„±
        function createTimeIndicator() {
            // ê¸°ì¡´ ì‹œê°„ í‘œì‹œê¸° ì œê±°
            const existing = document.getElementById('timeIndicator');
            if (existing) {
                existing.remove();
            }
            
            const indicator = document.createElement('div');
            indicator.id = 'timeIndicator';
            indicator.className = 'time-indicator';
            indicator.textContent = 'ì‹œê°„ ì„ íƒ ì¤‘...';
            document.body.appendChild(indicator);
        }
        
        // ì‹œê°„ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
        function updateTimeIndicator() {
            const indicator = document.getElementById('timeIndicator');
            if (indicator && dragState.startTime !== null && dragState.endTime !== null) {
                const startTime = timeSlots[dragState.startTime];
                const endTime = timeSlots[dragState.endTime];
                indicator.textContent = `${startTime} - ${endTime}`;
            }
        }
        
        // ì„ì‹œ ì˜ˆì•½ ë¸”ë¡ ì—…ë°ì´íŠ¸ (íŠ¹ì • ì¢Œì„ì—ë§Œ)
        function updateTempReservation(startTime, endTime) {
            // ê¸°ì¡´ ì„ì‹œ ë¸”ë¡ ì œê±°
            const existingTemp = document.querySelector('.reservation-temp');
            if (existingTemp) {
                existingTemp.remove();
            }
            
            if (!dragState.startSlot || endTime <= startTime) return;
            
            // ì‹œì‘ ìŠ¬ë¡¯ì˜ ì¢Œì„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const startDay = parseInt(dragState.startSlot.getAttribute('data-day'));
            const startSeat = parseInt(dragState.startSlot.getAttribute('data-seat'));
            
            // í•´ë‹¹ ì¢Œì„ì˜ ì„¸ë¡œ ì—´ ì°¾ê¸°
            const seatColumn = findSeatColumn(dragState.startSlot);
            if (seatColumn.length === 0) return;
            
            // ì‹œì‘ ì‹œê°„ì— í•´ë‹¹í•˜ëŠ” ìŠ¬ë¡¯ ì°¾ê¸°
            const startSlot = seatColumn.find(slot => 
                parseInt(slot.getAttribute('data-time-index')) === startTime
            );
            
            if (!startSlot) return;
            
            const duration = endTime - startTime;
            const block = document.createElement('div');
            block.className = 'reservation-temp';
            block.style.position = 'absolute';
            block.style.left = '2px';
            block.style.right = '2px';
            block.style.top = '0px';
            block.style.height = (duration * 60) + 'px';
            
            // ì„ íƒëœ ìƒ‰ìƒ ì ìš©
            const selectedOption = document.querySelector('.color-option.selected');
            if (selectedOption) {
                const color = selectedOption.style.backgroundColor || getComputedStyle(selectedOption).backgroundColor;
                block.style.backgroundColor = color.replace('rgb', 'rgba').replace(')', ', 0.5)');
                block.style.border = `1px solid ${color}`;
            } else {
                // ê¸°ë³¸ ìƒ‰ìƒ
                block.style.backgroundColor = 'rgba(59, 130, 246, 0.5)';
                block.style.border = '1px solid #3b82f6';
            }
            
            block.style.borderRadius = '4px';
            block.style.zIndex = '10';
            block.textContent = 'ìƒˆ ì˜ˆì•½';
            block.style.color = 'white';
            block.style.display = 'flex';
            block.style.alignItems = 'center';
            block.style.justifyContent = 'center';
            block.style.fontSize = '12px';
            block.style.fontWeight = 'bold';
            
            // ì‹œì‘ ìŠ¬ë¡¯ì— ì§ì ‘ ì¶”ê°€
            startSlot.style.position = 'relative';
            startSlot.appendChild(block);
        }
        
        
        
        // ë“œë˜ê·¸ ì •ë¦¬
        function cleanupDrag() {
            // ì‹œê°„ í‘œì‹œê¸° ì œê±°
            const timeIndicator = document.getElementById('timeIndicator');
            if (timeIndicator) {
                timeIndicator.remove();
            }
            
            // ì„ì‹œ ì˜ˆì•½ ë¸”ë¡ ì œê±°
            const tempReservations = document.querySelectorAll('.reservation-temp');
            tempReservations.forEach(temp => temp.remove());
        }
        
        // ì„œë²„ì— ì˜ˆì•½ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function saveReservationToServer(reservationData) {
            console.log('ì„œë²„ì— ì˜ˆì•½ ë°ì´í„° ì „ì†¡:', reservationData);
            
            return fetch('api/save_reservation_simple.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(reservationData)
            })
            .then(response => {
                console.log('ì„œë²„ ì‘ë‹µ ìƒíƒœ:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text().then(text => {
                    console.log('ì„œë²„ ì‘ë‹µ í…ìŠ¤íŠ¸:', text);
                    try {
                        return JSON.parse(text);
                    } catch (e) {
                        console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', e);
                        console.error('ì‘ë‹µ í…ìŠ¤íŠ¸:', text);
                        throw new Error('ì„œë²„ ì‘ë‹µì´ ìœ íš¨í•œ JSONì´ ì•„ë‹™ë‹ˆë‹¤: ' + text);
                    }
                });
            })
            .then(result => {
                console.log('ì„œë²„ ì‘ë‹µ ë°ì´í„°:', result);
                if (result.success) {
                    return result.reservationId;
                } else {
                    throw new Error(result.message || 'ì˜ˆì•½ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('ì˜ˆì•½ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                console.error('ì˜¤ë¥˜ ìƒì„¸:', error.message);
                console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', error.stack);
                throw error;
            });
        }
        
        // ì„œë²„ì—ì„œ ì˜ˆì•½ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
        function loadReservationsFromServer() {
            return fetch('api/get_reservations.php')
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    // í˜„ì¬ ì£¼ì˜ ë‚ ì§œ ë²”ìœ„ì— ë§ëŠ” ì˜ˆì•½ë§Œ í•„í„°ë§
                    const currentWeek = getCurrentWeek();
                    const weekStart = new Date(currentWeek[0]);
                    const weekEnd = new Date(currentWeek[6]);
                    weekStart.setHours(0, 0, 0, 0);
                    weekEnd.setHours(23, 59, 59, 999);
                    
                    console.log('í˜„ì¬ ì£¼ ë²”ìœ„:', {
                        weekStart: weekStart.toISOString().split('T')[0],
                        weekEnd: weekEnd.toISOString().split('T')[0]
                    });
                    
                    const filteredReservations = result.reservations.filter(reservation => {
                        // reservation_dateê°€ ìˆìœ¼ë©´ ê·¸ê²ƒì„ ì‚¬ìš©, ì—†ìœ¼ë©´ targetDayë¡œ ê³„ì‚°
                        if (reservation.reservationDate) {
                            const reservationDate = new Date(reservation.reservationDate);
                            reservationDate.setHours(0, 0, 0, 0);
                            const isInCurrentWeek = reservationDate >= weekStart && reservationDate <= weekEnd;
                            
                            console.log('ì˜ˆì•½ í•„í„°ë§ (reservation_date ì‚¬ìš©):', {
                                reservationId: reservation.id,
                                reservationDate: reservation.reservationDate,
                                isInCurrentWeek: isInCurrentWeek
                            });
                            
                            return isInCurrentWeek;
                        } else {
                            // reservation_dateê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ ì‚¬ìš©
                            const targetDay = parseInt(reservation.targetDay);
                            if (isNaN(targetDay) || targetDay < 1 || targetDay > 7) {
                                return false;
                            }
                            
                            const reservationDate = new Date(currentWeek[targetDay - 1]);
                            reservationDate.setHours(0, 0, 0, 0);
                            const isInCurrentWeek = reservationDate >= weekStart && reservationDate <= weekEnd;
                            
                            console.log('ì˜ˆì•½ í•„í„°ë§ (targetDay ì‚¬ìš©):', {
                                reservationId: reservation.id,
                                targetDay: targetDay,
                                reservationDate: reservationDate.toISOString().split('T')[0],
                                isInCurrentWeek: isInCurrentWeek
                            });
                            
                            return isInCurrentWeek;
                        }
                    });
                    
                    console.log('í•„í„°ë§ëœ ì˜ˆì•½ ìˆ˜:', filteredReservations.length);
                    return filteredReservations;
                } else {
                    throw new Error(result.message);
                }
            })
            .catch(error => {
                console.error('ì˜ˆì•½ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                throw error;
            });
        }
        
        // ì„œë²„ì—ì„œ ì˜ˆì•½ ìˆ˜ì •í•˜ëŠ” í•¨ìˆ˜
        function updateReservationOnServer(reservationId, reservationData) {
            return fetch('api/update_reservation.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    action: 'update',
                    reservationId: reservationId,
                    ...reservationData
                })
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    return result;
                } else {
                    throw new Error(result.message);
                }
            });
        }
        
        // ì„œë²„ì—ì„œ ì˜ˆì•½ ì‚­ì œí•˜ëŠ” í•¨ìˆ˜
        function deleteReservationFromServer(reservationId) {
            console.log('ğŸ—‘ï¸ deleteReservationFromServer í˜¸ì¶œë¨:', reservationId);
            
            const requestData = {
                action: 'delete',
                reservationId: reservationId
            };
            
            console.log('ğŸ“¤ ì„œë²„ì— ì „ì†¡í•  ë°ì´í„°:', requestData);
            
            return fetch('api/update_reservation.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => {
                console.log('ğŸ“¥ ì„œë²„ ì‘ë‹µ ìƒíƒœ:', response.status);
                return response.json();
            })
            .then(result => {
                console.log('ğŸ“¥ ì„œë²„ ì‘ë‹µ ë°ì´í„°:', result);
                if (result.success) {
                    return result;
                } else {
                    throw new Error(result.message || 'ì„œë²„ì—ì„œ ì‚­ì œ ì‹¤íŒ¨');
                }
            })
            .catch(error => {
                console.error('âŒ deleteReservationFromServer ì˜¤ë¥˜:', error);
                throw error;
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„œë²„ì—ì„œ ì˜ˆì•½ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadReservationsOnPageLoad() {
            try {
                const reservations = await loadReservationsFromServer();
                
                // ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¨ ì˜ˆì•½ë“¤ì„ í™”ë©´ì— í‘œì‹œ
                if (reservations && reservations.length > 0) {
                    // ê° ì˜ˆì•½ì— ëŒ€í•´ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬
                    const processReservations = async () => {
                        for (let index = 0; index < reservations.length; index++) {
                            const reservation = reservations[index];
                            
                            // targetDayì™€ targetSeatì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì • (í•˜ì§€ë§Œ ì„œë²„ì—ì„œ ì˜¬ë°”ë¥¸ ê°’ì´ ì™€ì•¼ í•¨)
                            let targetDay = reservation.targetDay || 1;
                            let targetSeat = reservation.targetSeat || 1;
                            
                            // targetDayê°€ ìœ íš¨í•œì§€ í™•ì¸ (1-7 ë²”ìœ„)
                            if (targetDay < 1 || targetDay > 7) {
                                console.warn('ì˜ëª»ëœ targetDay ê°’:', targetDay, 'ê¸°ë³¸ê°’ 1ë¡œ ì„¤ì •');
                                targetDay = 1;
                            }
                            
                            // targetSeatì´ ìœ íš¨í•œì§€ í™•ì¸ (1-6 ë²”ìœ„)
                            if (targetSeat < 1 || targetSeat > 6) {
                                console.warn('ì˜ëª»ëœ targetSeat ê°’:', targetSeat, 'ê¸°ë³¸ê°’ 1ë¡œ ì„¤ì •');
                                targetSeat = 1;
                            }
                            
                            // íšŒì› IDê°€ ìˆìœ¼ë©´ ì„œë²„ì—ì„œ ìµœì‹  product_hours ê°€ì ¸ì˜¤ê¸°
                            let productHours = reservation.product_hours || reservation.productHours || 0;
                            console.log('ì´ˆê¸° productHours:', productHours, 'íƒ€ì…:', typeof productHours);
                            
                            if (reservation.memberId && reservation.memberType !== 'quick') {
                                try {
                                    const memberResponse = await fetch(`api/debug_member_detail.php?id=${reservation.memberId}`);
                                    const memberResult = await memberResponse.json();
                                    if (memberResult.success && memberResult.member) {
                                        productHours = memberResult.member.product_hours || 0;
                                        console.log(`íšŒì› ${reservation.memberId}ì˜ ìµœì‹  product_hours:`, productHours);
                                    }
                                } catch (error) {
                                    console.error('íšŒì› ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                                }
                            }
                            
                            // productHoursë¥¼ ìˆ«ìë¡œ ë³€í™˜
                            productHours = Number(productHours) || 0;
                            console.log('ìµœì¢… productHours:', productHours, 'íƒ€ì…:', typeof productHours);
                            
                            console.log('ì˜ˆì•½ ë¸”ë¡ ìƒì„± ì‹œë„:', {
                                memberName: reservation.memberName,
                                targetDay: targetDay,
                                targetSeat: targetSeat,
                                startHour: reservation.startHour,
                                endHour: reservation.endHour,
                                productHours: productHours
                            });
                        
                            createReservationBlock(
                                reservation.memberName,
                                reservation.memberId,
                                reservation.memberType,
                                reservation.scheduleType,
                                reservation.startHour,
                                reservation.startMinute,
                                reservation.endHour,
                                reservation.endMinute,
                                reservation.reservationMemo,
                                reservation.educationMemos,
                                reservation.functionTestDate,
                                reservation.roadTestDate,
                                reservation.id,
                                targetDay,
                                targetSeat,
                                reservation.productName || reservation.product_name || reservation.product || '',
                                productHours,
                                reservation.contactPhone || ''
                            );
                        }
                    };
                    
                    processReservations();
                } else {
                    console.log('ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¨ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤.');
                }
                
                // ëª¨ë“  ì˜ˆì•½ ë¸”ë¡ì˜ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
                setTimeout(() => {
                    updateAllReservationBlockColors();
                }, 1000); // 1ì´ˆ í›„ì— ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            } catch (error) {
                console.error('ì˜ˆì•½ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜ˆì•½ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°ëŠ” ìœ„ì˜ DOMContentLoadedì—ì„œ ì²˜ë¦¬ë¨
    </script>
</body>
</html>